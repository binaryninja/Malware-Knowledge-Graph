Deep analysis of REvil Ransomware | Written in Korean
medium.com/s2wlab/deep-analysis-of-revil-ransomware-written-in-korean-d1899c0e9317
S2W

June 25, 2021

S2
W
S2W
Jun 23, 2021
Β·
32 min read
Author: Sojun Ryu (hypen) @ S2WLAB Talon
We are working on the English version. Coming soon!

1/39

Photo by on

Executive Summary
μΉ¨ν¬κ³Όμ •
2019λ…„ 4μ›”μ— μ²μ λ“±μ¥ν• REvil λμ„¬μ›¨μ–΄λ” μ΄κΈ° μ¤λΌν΄ μ›Ήλ΅μ§ μ·¨μ•½μ  (CVE-2019β€“
2725)μ„ μ΄μ©ν•μ—¬ λ‹¤μ–‘ν• ν™κ²½μ— μµμ΄ μΉ¨ν¬λ¥Ό μ‹λ„
μ΄ν›„ Pulse Secure VPN μ·¨μ•½μ  (CVE-2019β€“11510), FortiOS VPN μ·¨μ•½μ  (CVE-2018β€“
13379) λ° RDP μ·¨μ•½μ  λ“± μ λ΅λ°μ΄ μ·¨μ•½μ μ΄ μ•„λ‹, ν¨μΉκ°€ μ μ©λκΈ° μ „μ N-day μ·¨μ•½μ μ„
ν†µν•΄ κΈ°μ—… ν™κ²½μ— μΉ¨ν¬λ¥Ό μ‹λ„ν•μ—¬ λ§¤μ° λ§μ€ κΈ°μ—…μ„ κ°μ—Όμ‹ν‚΄

2/39

μµκ·Όμ—λ” λ‹¤ν¬μ›Ήμ—μ„ μ΄λ―Έ μ λ…ν• μ•…μ„±μ½”λ“μΈ Gootkit, QBot, IcedIdμ™€ κ°™μ€ λ‹¤μ΄λ΅λ“ λ° λ΅
λ“μ— νΉν™”λ μ•…μ„±μ½”λ“μ— μν•΄ μ‹¤ν–‰λ¨

μ£Όμ” νΉμ§•
μ•”νΈν™” ν‚¤ κµν™ μ‹, λμ„¬μ›¨μ–΄ μ•…μ„±μ½”λ“λ“¤μ΄ μ£Όλ΅ μ‚¬μ©ν•λ” RSAλ¥Ό μ‚¬μ©ν•μ§€ μ•κ³  νƒ€μ› κ³΅μ„ 
κΈ°λ° μ•”νΈ(Elliptic Curve Cryptography)λ¥Ό μ‚¬μ©ν•λ©°, νμΌ μ•”νΈν™”μ—λ” Salsa20 μ•κ³ λ¦¬μ¦μ„
μ΄μ©ν•μ—¬ νμΌμ„ μ•”νΈν™”
λ΅μ»¬ λ“λΌμ΄λΈ λ‚΄ νμΌ λΏλ§ μ•„λ‹λΌ μ›κ²© λ“λΌμ΄λΈ λ° κ³µμ  λ“λΌμ΄λΈ λ‚΄ νμΌλ„ μ•”νΈν™”ν•
λ©°, IOCPκΈ°λ²•μ„ μ‚¬μ©ν• λΉ„λ™κΈ° I/Oλ°©μ‹μΌλ΅ μ•”νΈν™” μ†λ„λ¥Ό λ†’μ„
2019λ…„ 12μ›”λ¶€ν„° μμ²΄ Leak μ‚¬μ΄νΈλ¥Ό μ΄μν•μ—¬ ν”Όν•΄ κΈ°μ—…μΌλ΅λ¶€ν„° νƒμ·¨ν• λ°μ΄ν„°λ¥Ό κ²μ‹
ν•λ©°, ν‘μƒμ— μ‘ν•μ§€ μ•μ„ μ‹ λ°μ΄ν„°λ¥Ό κ³µκ°ν•λ” μ΄μ¤‘ κ°μ·¨ μ „λµμ„ μ‚¬μ©.
λΉ„νΈμ½”μΈμ„ ν†µν•΄ λΈκ°’μ„ μ§€λ¶λ°›λ‹¤κ°€ 2020λ…„ 4μ›”λ¶€ν„° λ¨λ„¤λ΅λ΅ λ³€κ²½ν•¨. ν•μ§€λ§ μµκ·Όμ—λ” ν”Ό
ν•΄μκ°€ λΉ„νΈμ½”μΈμΌλ΅ μ§€λ¶μ„ μ›ν•  μ‹, 10% μ¶”κ°€ κΈμ•΅μ„ λ‚Ό κ²½μ° λΉ„νΈμ½”μΈμΌλ΅λ„ μ§€λ¶λ°›μ
2021λ…„ 2μ›”λ¶€ν„°λ” κΈ°μ΅΄ Leak μ‚¬μ΄νΈλ¥Ό ν†µν• μ΄μ¤‘ κ°μ·¨ μ „λµμ—μ„ ν™νμ΄μ§€ DDoS κ³µκ²© λ°
ν”Όν•΄ κΈ°μ—…μ λΉ„μ¦λ‹μ¤ ννΈλ„μ—κ² VoIPλ΅ μ—°λ½ν•λ” ν‘λ°• λ°©μ‹μ„ μ¶”κ°€ν•κ² λ‹¤κ³  μ–ΈκΈ‰

μµκ·Ό μ΄μ
μµκ·Ό Darksideμ Colonial Pipeline κ³µκ²©, REvil λμ„¬μ›¨μ–΄μ JBS κ³µκ²© μ΄ν›„λ΅ λ―Έκµ­μ΄ λμ„¬μ›¨
μ–΄ κ³µκ²©μ— κ°•λ ¥ν•κ² λ€μ²ν•κ² λ‹¤λ” λ°ν‘ ν›„, REvilμ€ μ¤νλ ¤ λ―Έκµ­μ— λ€ν• κ³µκ²©μ„ λ©μ¶”μ§€ μ•
κ³ , λ”μ± λ” κ°•ν™”ν•κ² λ‹¤κ³  μ–ΈκΈ‰ν•¨
ν„μ¬κΉμ§€ REvil λμ„¬μ›¨μ–΄ μ΅°μ§μ€ Darkside λμ„¬μ›¨μ–΄ μ΅°μ§, LV λμ„¬μ›¨μ–΄ μ΅°μ§κ³Ό
Prometheus μ΅°μ§κΉμ§€ μµμ† 3κ°μ λμ„¬μ›¨μ–΄ μ΅°μ§κ³Ό μ—°κ΄€λμ–΄μμ

3/39

Overall flow of REvil Ransomware

Malware Information
: 2075566e7855679d66705741dabe82b4 : 136443e2746558b403ae6fc9d9b40bfa92b23420 :
12d8bfa1aeb557c146b98f069f3456cc8392863a2f4ad938722cd7ca1a773b39: 2021β€“03β€“21 21:46:43 :
Win32 EXE file

Detailed Analysis
1. RC4 μ•κ³ λ¦¬μ¦μ„ μ΄μ©ν•μ—¬ λ°μ΄ν„° λ³µνΈν™”
4/39

REvil λμ„¬μ›¨μ–΄λ” RC4μ•κ³ λ¦¬μ¦μ„ μ΄μ©ν•μ—¬ μ•…μ„±μ½”λ“ λ‚΄λ¶€μ— ν¬ν•¨λ Win32 APIν•¨μ μ£Όμ†, μ„¤μ •
μ •λ³΄ λ° λ¬Έμμ—΄μ„ λ³µνΈν™”ν•κ³  μ•…μ„± ν–‰μ„μ— μ‚¬μ©ν•λ‹¤. μ•…μ„±μ½”λ“λ§λ‹¤ μ‚¬μ©λλ” keyλ” μƒμ΄ν•λ‹¤.
RC4 key : 9UAo1qQ8ce4w13Jv36xcPgMz6NCykVjs

2. μƒμ„Έ μµμ…μ„ ν†µν•΄ μ„Έλ¶€ κΈ°λ¥ μ„¤μ •
λ³µνΈν™”λ μ •λ³΄ μ¤‘ μ•…μ„± ν–‰μ„μ— ν•„μ”ν• 19κ°μ μƒμ„Έ μµμ…μ΄ JSON ν•νƒλ΅ ν‘ν„λμ–΄ μλ‹¤. λ¶„μ„ν•
μƒν”μΈ 2.05 λ²„μ „μ κ° μµμ…λ³„ κΈ°λ¥μ€ μ•„λμ™€ κ°™λ‹¤.

Table 1. μƒμ„Έ μµμ…ν‘

3. μ•”νΈν™” μ‚¬μ „ μ‘μ—…
5/39

REvil λμ„¬μ›¨μ–΄λ” κΈ°μ΅΄ λμ„¬μ›¨μ–΄ κ·Έλ£Ήλ“¤μ΄ μ£Όλ΅ μ‚¬μ©ν•λ” RSAμ™€ AES μ•κ³ λ¦¬μ¦ μ΅°ν•©μ„ μ‚¬μ©ν•
μ§€ μ•κ³ , ECC Diffie hellman ν‚¤ κµν™κ³Ό AES-256μ΄ κ²°ν•©λ ECIES κ³µκ°ν‚¤ μ•κ³ λ¦¬μ¦κ³Ό Salsa20
λΉ„λ°€ν‚¤ μ•κ³ λ¦¬μ¦μΌλ΅ νμΌ λ° λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•λ‹¤. μ΄λ¥Ό μ„ν•΄ μ•…μ„±μ½”λ“ λ‚΄μ— ν•λ“μ½”λ”© λ keyλ¥Ό
μ΄μ©ν•μ—¬ μ•”νΈν™”μ— ν•„μ”ν• κµ¬μ΅°μ²΄ λ°μ΄ν„°λ¥Ό μ‚¬μ „μ— μƒμ„±ν•λ©°, μ΄λ¥Ό λ μ§€μ¤νΈλ¦¬μ— μ €μ¥ν•μ—¬ μ¬μ‹¤
ν–‰λμ–΄λ„ κΈ°μ΅΄μ— μƒμ„±λ keyλ¥Ό μ‚¬μ©ν•¨μΌλ΅μ¨ ν•΄λ‹Ή κ°’μ΄ λ°”λ€μ§€ μ•λ„λ΅ ν•λ‹¤. μ‚¬μ©λλ” λ μ§€μ¤νΈ
λ¦¬λ” REvil λμ„¬μ›¨μ–΄ λ²„μ „λ³„λ΅ μƒμ΄ν•λ‹¤.

Ecryption Flow
1) λ μ§€μ¤νΈλ¦¬ path : HKLM\SOFTWARE\BlackLivesMatter
key : 54k => value : κ³µκ²©μ κ³µκ°ν‚¤ (pk)key : aOwO => value : νμΌ μ•”νΈν™” keyμƒμ„±μ— μ‚¬μ©λ κ³µκ°
ν‚¤ (pk_key)key : Krdfp => value : κ³µκ²©μ κ³µκ°ν‚¤λ΅ μ•”νΈν™”λ λΉ„λ°€ν‚¤ κµ¬μ΅°μ²΄ (sk_key struct)key :
hq0G6x => value : μ μ‘μ λ§μ¤ν„°ν‚¤λ΅ μ•”νΈν™”λ λΉ„λ°€ν‚¤ κµ¬μ΅°μ²΄ (0_key struct)

6/39

2) HKLM κ²½λ΅μ— λ“±λ΅ μ‹¤ν¨ μ‹ HKCUλ΅ λ³€κ²½ν•μ—¬ λ“±λ΅ μ‹λ„

4. κ°μ—ΌκΈ°κΈ° μ •λ³΄ μμ§‘
μ΄ν›„ κ°μ—Όλ κΈ°κΈ°μ μ •λ³΄λ¥Ό μμ§‘ν•λ‹¤. μμ§‘ λ©λ΅μ€ μ•„λμ™€ κ°™λ‹¤.
1) κ°μ—ΌκΈ°κΈ° μ‹λ³„ κ°’ (UID)
ν„μ¬ λ””μ¤ν¬μ VolumeSerialκ³Ό ν”„λ΅μ„Έμ„ μ΄λ¦„μ„ μμ§‘
κ°κ°μ CRC32 μ²΄ν¬μ„¬ κ°’μ„ μ΅°ν•©ν• 16κΈ€μ λ¬Έμμ—΄
μμ‹ : 3EE1CF8D0ECB68EF
2) μ•”νΈν™” ν™•μ¥μ (Extension)
5~10κ°μ λλ¤ λ¬Έμ μ΅°ν•© λ¬Έμμ—΄ (κΈ°μ΅΄ ν™”μ΄νΈλ¦¬μ¤νΈμ— ν¬ν•¨λμ§€ μ•μ€)
μμ‹ : 670o6j8nm
μ΄ν›„ λ μ§€μ¤νΈλ¦¬μ— μƒμ„±ν• λλ¤ ν™•μ¥μ μ €μ¥
Path : HKLM\ SOFTWARE\\BlackLivesMatter
Key : x4WHjRs β†’ value : [λλ¤ ν™•μ¥μ]
HKLM κ²½λ΅μ— λ“±λ΅ μ‹¤ν¨ μ‹ HKCUλ΅ κ²½λ΅ λ³€κ²½
3) μ μ €λ…
4) μ»΄ν“¨ν„°λ…
5) ν„μ¬ κΈ°κΈ°μ λ„λ©”μΈλ… λ„λ©”μΈμ΄ μ—†μ„ κ²½μ° WORKGROUPμΌλ΅ μ§€μ •
6) ν„μ¬ μ§€μ—­ λ° μ‚¬μ© μ–Έμ–΄
7) ν„μ¬ μ μ €μ μ‚¬μ© μ–Έμ–΄, μ‹μ¤ν…μ κΈ°λ³Έ μ–Έμ–΄, ν‚¤λ³΄λ“ layoutμ„ μμ§‘ ν›„ CIS κµ­κ°€ μ—¬λ¶€ ν™•μΈ
8) μ΄μμ²΄μ  λ²„μ „
9) λ””μ¤ν¬ λ³„ μ „μ²΄ μ©λ‰ λ° μ‚¬μ© κ°€λ¥ν• μ©λ‰
10) μ»΄ν“¨ν„° x86, x64 μ—¬λ¶€

5. CISκµ­κ°€ μ—¬λ¶€ ν™•μΈ
μƒμ„Έ μµμ… μ¤‘ dbgμµμ…μ΄ FalseμΌ κ²½μ°, μ•„λμ™€ κ°™μ΄ μ μ € λ° μ‹μ¤ν… μ–Έμ–΄, ν‚¤λ³΄λ“ layoutμ„ ν™•μΈν•
μ—¬ CIS(λ…λ¦½κµ­κ°€μ—°ν•©) μ§€μ—­μ κΈ°κΈ°μΌ κ²½μ° μ•…μ„± ν–‰μ„λ¥Ό μν–‰ν•μ§€ μ•λ”λ‹¤. λ°λ©΄ dbg μµμ…μ΄ True
μΌ κ²½μ° κ³µκ²©μλ“¤μ λ””λ²„κΉ…μ©μΌλ΅ μ‹¤ν–‰λλ©° μ–Έμ–΄ λ° layoutμ„ ν™•μΈν•μ§€ μ•λ”λ‹¤.

7/39

Table 2. μ μ €/μ‹μ¤ν… μ–Έμ–΄μ™€ ν‚¤λ³΄λ“ λ μ΄μ•„μ›ƒ

6. νλΌλ―Έν„°λ¥Ό ν†µν• μ‹¤ν–‰ λ¨λ“ μ§€μ •

8/39

Table 3. νλΌλ―Έν„° λ©λ΅
-nolan: λ„¤νΈμ›ν¬ κ³µμ λ“λΌμ΄λΈλ” κ°μ—Ό λ€μƒμ—μ„ μ μ™Έ
1) νλΌλ―Έν„°λ΅ μ£Όμ–΄μ§€μ§€ μ•μ€ κ²½μ°, λ„¤νΈμ›ν¬ λ“λΌμ΄λΈ μ•”νΈν™” μ‹λ„
2) μ›κ²© λ“λΌμ΄λΈ μ•”νΈν™”: A~Zλ“λΌμ΄λΈ μ¤‘ μ›κ²© λ“λΌμ΄λΈ λ‚΄ νμΌ μ•”νΈν™”
3) κ³µμ  λ“λΌμ΄λΈ
ν„μ¬ μ—°κ²°λ λ¨λ“  κ³µμ  λ¦¬μ†μ¤ λ‚΄ νμΌ μ•”νΈν™”
λ„¤νΈμ›ν¬ μ»¨ν…μ¤νΈ λ‚΄ λ¨λ“  κ³µμ  λ¦¬μ†μ¤ λ‚΄ νμΌ μ•”νΈν™”
λ„¤νΈμ›ν¬μ λ¨λ“  κ³µμ  λ¦¬μ†μ¤ λ‚΄ νμΌ μ•”νΈν™”
μκµ¬μ μΌλ΅ μ—°κ²°λ λ¨λ“  κ³µμ  λ¦¬μ†μ¤ λ‚΄ νμΌ μ•”νΈν™”
9/39

μµκ·Ό μ—°κ²°λ λ¨λ“  κ³µμ  λ¦¬ μ†μ¤ λ‚΄ νμΌ μ•”νΈν™”
-nolocal: λ΅μ»¬ λ“λΌμ΄λΈλ” κ°μ—Ό λ€μƒμ—μ„ μ μ™Έ

1) νλΌλ―Έν„°λ΅ μ£Όμ–΄μ§€μ§€ μ•μ€ κ²½μ°, λ΅μ»¬ λ“λΌμ΄λΈ μ•”νΈν™” μ‹λ„
2) λ΅μ»¬ λ“λΌμ΄λΈ μ•”νΈν™”: A~Zλ“λΌμ΄λΈ μ¤‘, μ΄λ™μ‹ λ° μΌλ° λ“λΌμ΄λΈ λ‚΄ νμΌ μ•”νΈν™”
-smode: μλ„μ° κ³„μ • λΉ„λ°€λ²νΈ λ³€κ²½ λ° μ•μ „λ¨λ“λ΅ μ¬λ¶€ν…

1) μ•μ „λ¨λ“ λ¶€ν…μ΄ μ•„λ‹, μ •μƒ λ¨λ“λ΅ λ¶€ν…λμ—μ„ κ²½μ°μ—λ§ λ™μ‘
2) μ•μ „λ¨λ“μ—μ„ μ•”νΈν™”λ¥Ό ν•  κ²½μ°, λ°±μ‹  νƒμ§€λ¥Ό μ°νν•κ³  νμΌ μ•”νΈν™”μ μ„±κ³µλ¥ μ΄ λ†’μ•„μ§ μ μ
μ
3) ν„μ¬ κ³„μ •μ λΉ„λ°€λ²νΈλ¥Ό β€DTrump4everβ€λ΅ λ³€κ²½
4) λ μ§€μ¤νΈλ¦¬λ¥Ό λ³€κ²½ν•μ—¬ λ³€κ²½λ λΉ„λ°€λ²νΈλ΅ μλ™ λ΅κ·ΈμΈλλ„λ΅ μ„¤μ •
Path : HKLM\ SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
Key : AutoAdminLogon β†’ value : 1
Key : DefaultUserName β†’ value : ν„μ¬ μ μ € λ…
Key : DefaultPassword β†’ value : DTrump4ver
5) λ μ§€μ¤νΈλ¦¬ λ³€κ²½ ν›„ μ¬λ¶€ν… μ™„λ£μ‹ μ•…μ„±μ½”λ“ μ¬μ‹¤ν–‰ λ° λ¶€ν… λ¨λ“ μ •μƒ λ¨λ“λ΅ λ³µκµ¬
Path : HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
Key : *AstraZeneca β†’ value : μ•…μ„±μ½”λ“ νμΌ λ…
(Vista μ΄μ „) Key : *MarineLePen β†’ value : bootcfg /raw /fastdetect /id 1
(Vista μ΄ν›„) Key : *MarineLePen β†’ value : bcdedit /deletevalue {current} safeboot
6) μ„¤μ • ν›„, λ¶€ν… λ¨λ“λ¥Ό λ„¤νΈμ›ν¬ κ°€λ¥ν• μ•μ „λ¨λ“λ΅ λ³€κ²½ν•λ” λ…λ Ήμ–΄ μ‹¤ν–‰
(Vista μ΄μ „) λ…λ Ήμ–΄ : bootcfg /raw /a /safeboot:network /id 1
(Vista μ΄ν›„) λ…λ Ήμ–΄ : bcdedit /set {current} safeboot network
7) μ„¤μ • μ™„λ£ ν›„ κ°μ—ΌκΈ°κΈ° μ¬λ¶€ν…
λ…λ Ήμ–΄ : SHUTDOWN -r -f -t 02
2μ΄ ν›„ μ‹μ¤ν…μ„ κ°•μ λ΅ μ¬λ¶€ν…
-silent: νΉμ • μ„λΉ„μ¤, ν”„λ΅μ„Έμ¤ μΆ…λ£ λ° λ³Όλ¥¨ μ„€λ„μ° μΉ΄ν”Ό μ‚­μ  μν–‰ν•μ§€ μ•μ

1) νλΌλ―Έν„°λ΅ μ£Όμ–΄μ§€μ§€ μ•μ€ κ²½μ°, νΉμ • μ„λΉ„μ¤μ™€ ν”„λ΅μ„Έμ¤ μΆ…λ£ λ° λ³Όλ¥¨ μ„€λ„μ° μΉ΄ν”Ό μ‚­μ 
2) Win32 APIλ¥Ό μ΄μ©ν•μ—¬ ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ νΉμ • ν”„λ΅μ„Έμ¤ μΆ…λ£
3) WMIλ΅ μ‹ κ· ν”„λ΅μ„Έμ¤ μƒμ„± Eventλ¥Ό λ¨λ‹ν„°λ§ν•μ—¬ νΉμ • ν”„λ΅μ„Έμ¤ μƒμ„± μ‹ μΆ…λ£

10/39

4) νΉμ • ν”„λ΅μ„Έμ¤ λ©λ΅

5) Win32 APIλ¥Ό μ΄μ©ν•μ—¬ ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ νΉμ • μ„λΉ„μ¤ μΆ…λ£
6) WMIλ΅ μ„λΉ„μ¤ λ³€λ™μ‚¬ν•­ Eventλ¥Ό λ¨λ‹ν„°λ§ν•μ—¬ νΉμ • μ„λΉ„μ¤ μ‹¤ν–‰ μ‹ μ¤‘μ§€
7) νΉμ • μ„λΉ„μ¤ λ©λ΅

11/39

8) WQL(SQL for WMI) μΏΌλ¦¬λ¥Ό μ΄μ©ν•μ—¬ κ°μ—Όλ κΈ°κΈ°μ Volume Shadow Copyλ¥Ό λ¨λ‘ μ‚­μ 
WQL Query : SELECT * FROM Win32_ShadowCopy
μ΄ν›„ Win32_ShadowCopy.ID=[μ΅°νν• ID]μ— λ€ν•μ—¬ DeleteInstance μ‘μ—… μν–‰
-path: νΉμ • κ²½λ΅μ— λ€ν•΄μ„λ§ μ•”νΈν™” μ§„ν–‰

1) μ£Όμ–΄μ§„ κ²½λ΅μ— λ€ν•΄μ„λ§ νμΌ μ•”νΈν™” μ§„ν–‰
2) λ„¤νΈμ›ν¬ λ° λ΅μ»¬ κ²½λ΅ μ—¬λ¶€ ν™•μΈν•μ—¬ μ§„ν–‰
3) μ „μ²΄ νμΌ μ•”νΈν™” μ „μ— κ³µκ²©μκ°€ ν…μ¤νΈ μ©λ„λ΅ μ‚¬μ©ν•λ” κΈ°λ¥

12/39

-pathλ΅ μ‹¤ν–‰λ  κ²½μ° κ¶ν• μƒμΉ, μ •λ³΄μ μ¶, λ°”νƒ•ν™”λ©΄ λ³€κ²½ λ“±μ„ μν–‰ν•μ§€ μ•μ
-fast: λΉ λ¥Έ μ•”νΈν™” λ¨λ“

1) -pathμ™€ ν•¨κ» μ‚¬μ©λλ©°, νμΌ μ•”νΈν™” μ‹ μƒμ„ 0x100000λ§ μ•”νΈν™”λ¥Ό μν–‰
2) μƒμ„Έ μµμ… μ¤‘ etκ°€ 1μΌ λ•μ™€ λ™μΌ
-full: μ „μ²΄ μ•”νΈν™” λ¨λ“

1) -pathμ™€ ν•¨κ» μ‚¬μ©λλ©°, νμΌ μ•”νΈν™” μ‹ νμΌ μ „μ²΄μ— λ€ν•΄μ„ μ•”νΈν™”λ¥Ό μν–‰
2) μƒμ„Έ μµμ… μ¤‘ etκ°€ 0μΌ λ•μ™€ λ™μΌ

7. λ™μ‘ κ³Όμ •
1) λ®¤ν…μ¤ μƒμ„±
μ•…μ„±μ½”λ“μ μ¤‘λ³µ μ‹¤ν–‰ λ°©μ§€λ¥Ό μ„ν•΄ νΉμ • λ¬Έμμ—΄μ„ μ΄μ©ν•μ—¬ λ®¤ν…μ¤ μƒμ„±
λ®¤ν…μ¤ λ… : Global\\F69C27FF-AB15-CCAA-A2D6β€“7F7ADA90E7E3
λ¬Έμμ—΄μ€ μ•…μ„±μ½”λ“λ§λ‹¤ λ‹¤λ¥Έ κ°’μ„ μ‚¬μ©
μ¤‘λ³µ μ‹¤ν–‰ μ‹ ν„μ¬ ν”„λ΅μ„Έμ¤λ¥Ό μΆ…λ£
2) μƒμ„Έ μµμ… exp (Table 1. μƒμ„Έ μµμ…ν‘ μ°Έκ³ )μ— λ”°λ¥Έ ν–‰μ„ μν–‰
μ μ €κ°€ κ΄€λ¦¬μ κ¶ν•μ„ κ°–κ³  μμ§€λ§, ν”„λ΅μ„Έμ¤κ°€ κ΄€λ¦¬μ κ¶ν•μ„ κ°–μ§€ μ•μ€ κ²½μ° ν”„λ΅μ„Έμ¤ μ¬
μ‹¤ν–‰
μ μ €κ°€ μΉλ‚™ν•  λ•κΉμ§€ κ΄€λ¦¬μ κ¶ν•μΌλ΅ μ‹¤ν–‰μ„ μ”κµ¬ν•λ” UAC μλ½ μ”μ²­ μ°½μ„ ν™”λ©΄ μƒμ— κ³„
μ† ν‘μ¶
3) μ•”νΈν™” μ‘μ—… μ „ κΈ°νƒ€ ν–‰μ„
κ°•μ λ΅ ν΄μ§€ν†µ λΉ„μ°κΈ°
ν”„λ΅μ„Έμ¤μ CPU μ¤μΌ€μ¤„λ§ μ°μ„ μμ„λ¥Ό μΌλ° ν”„λ΅μ„Έμ¤λ³΄λ‹¤ ν• λ‹¨κ³„ μƒμΉμ‹μΌ λ¦¬μ†μ¤ μ‚¬μ©
ν”„λ΅μ„Έμ¤κ°€ μ‹¤ν–‰λλ” λ„μ¤‘ μ μ „ λ¨λ“ μ „ν™ λ° λ””μ¤ν”λ μ΄ κΊΌμ§ λ°©μ§€
SeDebugPrivilege κ¶ν•μ„ ν• λ‹Ήν•μ—¬ νƒ€ ν”„λ΅μ„Έμ¤μ— μ ‘κ·Ό κ°€λ¥ν•λ„λ΅ κ¶ν• μ„¤μ •
4) μƒμ„Έ μµμ… arn (Table 1. μƒμ„Έ μµμ…ν‘ μ°Έκ³ ) μ— λ”°λ¥Έ ν–‰μ„ μν–‰
λ μ§€μ¤νΈλ¦¬λ¥Ό λ³€κ²½ν•μ—¬ κΈ°κΈ°λ¥Ό μ¬λ¶€ν…ν•λ”λΌλ„ μ•…μ„±μ½”λ“κ°€ μ‹¤ν–‰λλ„λ΅ μ„¤μ •
Path : HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
Key : 3"qZhotTgfr3 β†’ value : μ•…μ„±μ½”λ“ νμΌ λ…
HKLM κ²½λ΅μ— λ“±λ΅ μ‹¤ν¨ μ‹ HKCUλ΅ λ³€κ²½
5) λ°”νƒ•ν™”λ©΄ λ³€κ²½

13/39

1. λ°”νƒ•ν™”λ©΄μ„ νλ€μƒ‰ λ°°κ²½μ— μμ‹ λ“¤μ λ©”μ‹μ§€κ°€ λ‹΄κΈ΄ μ΄λ―Έμ§€λ΅ λ³€κ²½
μ›λ³Έ μ΄λ―Έμ§€ νμΌ κ²½λ΅ : %temp%\[λλ¤ 3~13κ°μ λ¬Έμμ—΄].bmp
μ•„λλ” μƒμ„Έ μµμ… imgμ— λ…μ‹λ ν‘λ°• λ©”μ‹μ§€μ΄λ©°, ν‘λ°• λ©”μ‹μ§€ μƒμ— instuctions μ€
instructionμ μ¤νƒ€μ„
All of Your fiels are encrypted!Find [Random Extension]-readme.txt and follow
instuctions

μ‹¤μ  λ³€κ²½λ λ°”νƒ•ν™”λ©΄

Compromised Background
6) μƒμ„Έ μµμ… net μ— λ”°λ¥Έ ν–‰μ„ μν–‰

14/39

1. JSON ν•νƒλ΅ κ°μ—ΌκΈ°κΈ° μ •λ³΄ λ° μ•”νΈν™”μ— μ‚¬μ©λ μ •λ³΄ μμ§‘
{
"ver": [REvil λμ„¬μ›¨μ–΄ λ²„μ „],
"pid": [μ•…μ„±μ½”λ“ μ‹λ³„μ], (μƒμ„Έμµμ…μ— λ…μ‹λ¨)
"sub":
[μ•…μ„±μ½”λ“ μ‹λ³„μ], (μƒμ„Έμµμ…μ— λ…μ‹λ¨)
"pk": [μ•”νΈν™”μ— μ‚¬μ©λ κ³µκ°ν‚¤ μ •λ³΄], (μƒμ„Έμµμ…μ— λ…μ‹λ¨)
"uid": [Victim ID],
"sk": [sk_key struct(λΉ„λ°€ν‚¤ κµ¬μ΅°μ²΄)],
"unm": [μ μ € λ…],
"net":
[μ»΄ν“¨ν„° λ…],
"grp": [λ„λ©”μΈ λ…],
"lng": [μ§€μ—­ λ° μ‚¬μ©μ–Έμ–΄],
"bro": [CIS κµ­κ°€ μ—¬λ¶€],
"os": [μ΄μμ²΄μ  λ²„μ „],
"bit": [32bit λλ” 64bit μ—¬λ¶€],
"dsk": [λ””μ¤ν¬ λ³„ μ „μ²΄ μ©λ‰ λ° μ‚¬
μ© κ°€λ¥ν• μ©λ‰ μ •λ³΄],
"ext": [μ•”νΈν™” ν™•μ¥μ]"}

2. λ¨λ“  μ •λ³΄λ¥Ό μ·¨ν•©ν• λ’¤, νμΌκ³Ό λ™μΌν• λ°©μ‹μΌλ΅ λ°μ΄ν„°λ¥Ό μ•”νΈν™”
λ°μ΄ν„° μ•”νΈν™”μ—λ” μ•…μ„±μ½”λ“ λ‚΄μ— λ³„λ„λ΅ ν•λ“μ½”λ”©λ κ³µκ° key μ‚¬μ©
3. μ•”νΈν™”ν• λ°μ΄ν„°λ¥Ό λ μ§€μ¤νΈλ¦¬μ— μ €μ¥
Path : HKLM\SOFTWARE\BlackLivesMatter
Key : XFx41h1r β†’ value : [μ•”νΈν™” λ κ°μ—ΌκΈ°κΈ° μ •λ³΄ λ° μ•”νΈν™”μ— μ‚¬μ©λ μ •λ³΄]
HKLM κ²½λ΅μ— λ“±λ΅ μ‹¤ν¨ μ‹ HKCUλ΅ λ³€κ²½
4. μƒμ„Έ μµμ… μ¤‘ dmn μ— μ €μ¥λμ–΄ μλ” λ„λ©”μΈ λ³„λ΅ μ•„λ κ·Έλ¦Όκ³Ό κ°™μ΄ νΉμ • λ¬Έμμ—΄μ„ μ΅°ν•©ν•μ—¬
λλ¤ URL μ£Όμ† μƒμ„±ν•μ—¬ μ ‘μ† μ‹λ„

15/39

URL μ£Όμ† μƒμ„± λ°©μ‹
5. λ„λ©”μΈλ³„λ΅ μƒμ„±λ URLμ£Όμ†λ΅ μμ§‘ν• κ°μ—ΌκΈ°κΈ° μ •λ³΄ λ©λ΅ μ „μ†΅
User-agent : Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
like Gecko) Chrome/84.0.4147.125 Safari/537.36
Method : POST
Header : Content-Type: application/octet-stream
Header : Connection: close
7) λ©”λ¨λ¦¬ μ •λ¦¬
1. κ°μ—Όμ •λ³΄ μ „μ†΅κ³Ό λ¨λ“  νμΌ μ•”νΈν™”λ¥Ό λ§μΉ λ’¤ κ΄€λ ¨ λ°μ΄ν„°λ¥Ό λ¨λ‘ μ •λ¦¬

16/39

2. μƒμ„Έ μµμ… λ° μ•”νΈν™”μ— μ‚¬μ©λ ν‚¤ μ •λ³΄, κ°μ—ΌκΈ°κΈ° μ •λ³΄κ°€ ν• λ‹Ήλ λ©”λ¨λ¦¬λ¥Ό λ¨λ‘ ν•΄μ ν•¨
8) νμΌ μ‚­μ 
1. μ¬λ¶€ν…λ  κ²½μ° μ•…μ„±μ½”λ“κ°€ μ‚­μ λλ„λ΅ μ„¤μ •

8. νμΌ μ•”νΈν™” Thread
1) Input/output completion port (IOCP)λ¥Ό μ΄μ©ν• μ•”νΈν™” μ‘μ—… μν–‰
REvil λμ„¬μ›¨μ–΄λ” IOCPλ¥Ό μ΄μ©ν• λΉ„λ™κΈ° μ…μ¶λ ¥ λ°©μ‹μΌλ΅ λΉ λ¥Έ μ•”νΈν™”λ¥Ό μν–‰ν•¨
κ°μ—Ό κΈ°κΈ°μ ν”„λ΅μ„Έμ„ κ°―μ * 2κ°μ μ•”νΈν™” μ „λ‹΄ Thread μƒμ„±
2) ECIES()λ¥Ό μ΄μ©ν• νμΌ μ•”νΈν™”
REvil λμ„¬μ›¨μ–΄λ” ECC Diffie Hellman ν‚¤ κµν™ λ°©μ‹μ„ μ‚¬μ©ν•μ—¬ ν‚¤ κµν™μ„ μ‹λ„ν•¨
ν‚¤ μƒμ„±μ—λ” Curve25519λ¥Ό μ‚¬μ©ν•λ”λ°, μ΄λ” κ°€μ¥ λΉ λ¥Έ κ³΅μ„  μ¤‘ ν•λ‚λ΅ μ•λ ¤μ§
λμ„¬μ›¨μ–΄ λ°”μ΄λ„λ¦¬ λ‚΄μ— λ―Έλ¦¬ ν¬ν•¨λμ–΄ μλ” pk (Attacker Key)λ¥Ό μ΄μ©ν•μ—¬ μ‹¤μ  νμΌ μ•”νΈ
ν™”μ— μ‚¬μ©λλ” dk_keyμ— λ€ν• μ•”νΈν™” μ§„ν–‰
pk μ™Έμ— Master Keyκ°€ μ΅΄μ¬ν•λ”λ°, μ΄λ” REvil λμ„¬μ›¨μ–΄μ λ©”μ΄μ € λ²„μ „λ§λ‹¤ λ™μΌν• κ°’μ„ κ°€
μ§€λ©°, REvil λμ„¬μ›¨μ–΄ μ μ‘μκ°€ μ–Έμ λ“ μ§€ νμΌμ„ λ³µνΈν™”ν•  μ μλ” μ©λ„λ΅ μ‚¬μ©λ¨

17/39

Master keyμ™€ Attacke keyλ¥Ό μ΄μ©ν• dk_key κ°λ³„ μ•”νΈν™”
3) μ•”νΈν™” λ€μƒμ—μ„ νΉμ • νμΌ, ν΄λ” λ° ν™•μ¥μ μ μ™Έ
μ΄μμ²΄μ μ™€ κ΄€λ ¨λκ±°λ‚ μ¤‘μ”λ„κ°€ λ‚®μ€ ν΄λ”λ¥Ό μ•”νΈν™” λ€μƒμ—μ„ μ μ™Έ

18/39

λ¶€ν… λλ” μ΄μμ²΄μ  κ΄€λ ¨ νμΌμ„ μ•”νΈν™” λ€μƒμ—μ„ μ μ™Έ

19/39

μ‹¤ν–‰ ν”„λ΅κ·Έλ¨ λλ” μ¤ν¬λ¦½νΈλ“±κ³Ό κ°™μ€ λ¶ν•„μ”ν• ν™•μ¥μλ¥Ό κ°μ—Ό λ€μƒμ—μ„ μ μ™Έ

20/39

νƒ€κ² νμΌμ— μ ‘κ·Ό μ¤‘μΈ μ„λΉ„μ¤ λ° ν”„λ΅μ„Έμ¤ μ¤‘ μ•„λ ν”„λ΅μ„Έμ¤λ¥Ό μ μ™Έν• μ„λΉ„μ¤μ™€ ν”„λ΅μ„Έμ¤
λ¥Ό λ¨λ‘ μΆ…λ£

21/39

νμΌμ λ§μ§€λ§‰ 176byteμ„μΉμ 32byteλ¥Ό μ½μ€ λ’¤ CRC32 checksumμ΄ λ§μ§€λ§‰ 216byteμ„μΉ
μ 4byteκ°’κ³Ό λ™μΌν• κ²½μ°, μ΄λ―Έ μ•”νΈν™”κ°€ λ νμΌλ΅ νλ‹¨ν•μ—¬ μ•”νΈν™” λ€μƒμ—μ„ μ μ™Έ
4) νμΌ μ•”νΈν™”
μƒμ„Έ μµμ… μ¤‘ et μ— λ”°λΌ μ•”νΈν™” λ¨λ“κ°€ κµ¬λ¶„λλ©°, κΈ°λ³Έμ μΌλ΅ 0x100000(1MB) ν¬κΈ° λ‹¨μ„λ΅ ν
μΌ μ•”νΈν™”κ°€ μ΄λ£¨μ–΄μ§€κ³  μ•„λμ™€ κ°™μ€ μµμ…μ— λ”°λΌ μ¶”κ°€ μ•”νΈν™” ν¬κΈ°κ°€ μ •ν•΄μ§
, νμΌ μ „μ²΄ μ•”νΈν™”
, νμΌμ μƒμ„ 0x100000λ§ μ•”νΈν™”
, νμΌμ μƒμ„ 0x100000μ•”νΈν™”. μ΄ν›„, spize μµμ…μ— λ…μ‹λ ν¬κΈ°λ§νΌ κ°„κ²©μ„ λ‘μ–΄
0x100000μ”© μ¶”κ°€λ΅ νμΌ μ•”νΈν™” (spsizeμ— μ£Όμ–΄μ§„ ν¬κΈ°λ” MBλ‹¨μ„)

22/39

File Encryption Modes
νμΌ λ³„λ΅ 4x4 key matrixλ¥Ό μƒμ„±ν•μ—¬ Salsa20 μ•κ³ λ¦¬μ¦μΌλ΅ νμΌμ„ μ•”νΈν™”ν•λ©°, Salsa20μ—μ„
μ‚¬μ©λλ” key matrix κµ¬μ΅°λ” μ•„λμ™€ κ°™μ. REvil λμ„¬μ›¨μ–΄λ” μ•„λ Keyμμ—­μ—λ” μƒμ„±ν• Shared
Keyμ SHA-3 ν•΄μ‹ κ°’μ„ μ‚¬μ©ν•κ³ , Nonceλ” λλ¤μΌλ΅ μƒμ„±ν• 8byte, Posλ” 0μΌλ΅ μ„¤μ •

23/39

et μ— λ”°λΌ νμΌ μ•”νΈν™”λ¥Ό λ§μΉ λ’¤, μ•”νΈν™”μ— μ‚¬μ©λ 232byteμ λ©”νƒ€λ°μ΄ν„°λ¥Ό νμΌμ— μ¶”κ°€

sk_key struct : κ³µκ²©μ κ³µκ°ν‚¤λ΅ μ•”νΈν™”λ λΉ„λ°€ν‚¤ κµ¬μ΅°μ²΄
0_key struct : μ μ‘μ λ§μ¤ν„°ν‚¤λ΅ μ•”νΈν™”λ λΉ„λ°€ν‚¤ κµ¬μ΅°μ²΄
Meta data struct : κ³µκ°ν‚¤, μ•”νΈν™” λ¨λ“ λ“±μ΄ ν¬ν•¨λ μ•”νΈν™”μ— μ‚¬μ©λ μ •λ³΄ κµ¬μ΅°μ²΄

24/39

Key struct and Meta data struct
4) μ•”νΈν™” ν›„ νμΌ ν™•μ¥μ λ³€κ²½
νμΌμ μ•”νΈν™”κ°€ μ™„λ£λλ©΄ μ›λ³Έ νμΌμ ν™•μ¥μλ¥Ό κΈ°μ΅΄μ— μƒμ„±ν• λλ¤ λ¬Έμμ—΄λ΅ λ³€κ²½
5) λμ„¬λ…ΈνΈ μƒμ„±
1. μƒμ„Έ μµμ… λ° κΈ°μ΅΄μ— μƒμ„±ν• λλ¤ ν™•μ¥μλ¥Ό μ΄μ©ν•μ—¬ ν΄λ”λ§λ‹¤ λμ„¬λ…ΈνΈ μƒμ„±
2. nbody μµμ… : λμ„¬λ…ΈνΈ νμΌλ… ν¬λ§· β†’ [λλ¤ ν™•μ¥μ]-readme.txt
3. nname μµμ… : λμ„¬λ…ΈνΈ λ‚΄μ© ν¬λ§·

25/39

: κ°μ—Ό κΈ°κΈ° μ‹λ³„ κ°’
: μ •λ³΄μ μ¶μ§€λ΅ μ „μ†΅ν• μμ§‘λ μ •λ³΄μ base64 encoding ν•νƒ
: λλ¤ ν™•μ¥μ
4. λμ„¬λ…ΈνΈ μμ‹

5. μ•”νΈν™” μ „μ²΄ κ³Όμ •

26/39

6) λ³µνΈν™” μμ‹
1. κ³µκ²©μλ” μ•”νΈν™”λ νμΌλ΅λ¶€ν„° sk_key structμ— μλ” pk_new μ¶”μ¶
2. κ³µκ²©μκ°€ κ°€μ§€κ³  μλ” dkμ™€ pk_newλ¥Ό μ΄μ©ν•μ—¬ shared key μƒμ„±
μ΄λ” μ•…μ„±μ½”λ“κ°€ pkμ™€ dk_newλ¥Ό μ΄μ©ν•μ—¬ μƒμ„±ν• shared keyμ™€ λ™μΌν•¨
ECDH (Elliiptic Curve Diffie-Hellman)μƒ μ•„λ μμ‹μ΄ μ„±λ¦½ν•κΈ° λ•λ¬Έ

27/39

π‘‘π΄: κ³µκ²©μμ private key (dk)
Qπ΄: κ³µκ²©μμ public key (pk)
π‘‘B: μ•…μ„±μ½”λ“μ private key (dk_key)
QB: μ•…μ„±μ½”λ“μ public key (pk_key)
3. μƒμ„±ν• shared keyμ™€ sk_key structμ— μλ” AES IVλ΅ λ³µνΈν™”ν•μ—¬ dk_key μ¶”μ¶
4. 2μ™€ λ™μΌν• λ°©μ‹μΌλ΅ dk_keyμ™€ Meta data structμ— μλ” pk_new_fileλ΅ shared key μƒμ„±
5. μƒμ„±ν• shared keyμ™€ Meta data structμ— μλ” Salsa nonceλ¥Ό μ΄μ©ν•μ—¬ Matrix μƒμ„± ν›„, Salsa
IVμ™€ ν•¨κ» μ•”νΈν™”λ νμΌ λ°μ΄ν„° λ³µνΈν™”

28/39

κ³µκ²© ATT&CK
μ¶μ² : Referenceμ— λ…μ‹λ λ¶„μ„ λΈ”λ΅κ·Έ λ‚΄ IoC μ·¨ν•©

Initial Access
1. μ·¨μ•½μ μ„ ν†µν•΄ μ›κ²© λ…λ Ήμ–΄ μ‹¤ν–‰ λ° μ ‘μ† μ‹λ„
μ¤λΌν΄ WebLogic μ·¨μ•½μ  (CVE-2019β€“2725)
Microsoft Exchange μ„λ²„ μ·¨μ•½μ  (μ •ν™•ν• CVEλ” λ°ν€μ§€μ§€ μ•μ)
Sharepoint μ·¨μ•½μ  (μ •ν™•ν• CVEλ” λ°ν€μ§€μ§€ μ•μ)
29/39

2. VPN μ·¨μ•½μ μ„ ν†µν• λ‚΄λ¶€ νμΌ νƒμ·¨ μ‹λ„
Pulse Secure SSL VPN (CVE-2019β€“11510)
FortiOS SSL VPN (CVE-2018β€“13379)
3. RDPλ¥Ό ν†µν• μΉ¨ν¬
μ·¨μ•½ν• RDP ν¨μ¤μ›λ“λ¥Ό νƒ€κ²ν•λ” bruteforce κ³µκ²© μ‹λ„
μ›κ²© μ½”λ“ μ‹¤ν–‰μ΄ κ°€λ¥ν• RDP Bluegate μ·¨μ•½μ  (CVE-2020β€“0609, CVE-2020β€“0610)
4. μ·¨μ•½ν• Citrix κ³„μ •μ„ ν†µν• μΉ¨ν¬
5. μ¤νΈ λ©”μΌμ„ ν†µν•΄ λ‹¤μ΄λ΅λ“ κΈ°λ¥μ μ•…μ„± λ§¤ν¬λ΅κ°€ ν¬ν•¨λ XLSM νμΌ μ ν¬
μ™μ† μμ•½ μ‚¬μ΄νΈ (booking.com)λ¥Ό μ„μ¥ν• ν”Όμ‹± λ©”μΌ
ν•΄μ™Έ λ°°μ† μ—…μ²΄ (DHL)λ΅ μ„μ¥ν• ν”Όμ‹± λ©”μΌ
DocuSign μ „μ μ„λ… λ©”μΌλ΅ μ„μ¥ν• ν”Όμ‹± λ©”μΌ
6. Supply chain
μ΄νƒλ¦¬μ•„μ WinRAR μ„¤μΉ ν”„λ΅κ·Έλ¨ κ³µμ‹ μ‚¬μ΄νΈ(winrar.it)λ¥Ό ν†µν•΄ λ°°ν¬
7. RIG Exploit kitμ„ ν†µν•΄ λ°°ν¬
RIG Exploit kitμ„ ν™μ©ν• Malvertising κ³µκ²©μΌλ΅ κ°μ—Ό μ‹λ„
8. MSSP λλ” MSP μ—…μ²΄λ¥Ό μ¥μ•… ν›„, κ²½μ ν•μ—¬ μΉ¨ν¬ μ‹λ„
9. SEO-Poisoning λ΅ μΈν•΄ κ²€μƒ‰μ—”μ§„ μƒλ‹¨μ— λ…Έμ¶λλ” μ›Ή μ‚¬μ΄νΈλ΅λ¶€ν„° μ•…μ„± νμΌ λ‹¤μ΄λ΅λ“
Execution
1. Powershell (.ps1) μ¤ν¬λ¦½νΈλ¥Ό μ΄μ©ν•μ—¬ λ…λ Ήμ–΄ μ‹¤ν–‰
DownloadFile λ…λ Ήμ–΄λ¥Ό ν†µν•΄ μ•…μ„±μ½”λ“ λ‹¤μ΄λ΅λ“ λ° μ‹¤ν–‰
2. μ•…μ„± μ½”λ“λ¥Ό λ“λ λ° μ‹¤ν–‰ν•λ” Javascript (.js) μ¤ν¬λ¦½νΈ
λ‚λ…ν™” λ javascript μ¤ν¬λ¦½νΈλ¥Ό μ‹¤ν–‰μ‹μΌ μ¶”κ°€ μ•…μ„±μ½”λ“ λ‹¤μ΄λ΅λ“
3. WMI (Windows Management Instrumentation) μΏΌλ¦¬λ¥Ό μ΄μ©ν•μ—¬ λ…λ Ήμ–΄ μ‹¤ν–‰
4. λ°°μΉ μ¤ν¬λ¦½νΈλ¥Ό μ΄μ©ν•μ—¬ λ‹¤μμ λ…λ Ήμ–΄λ¥Ό λ™μ‹μ— μ‹¤ν–‰

Persistence
1. ν΄λΌμ°λ“ μ›κ²© λ°μ¤ν¬ν†± μ†ν”„νΈμ›¨μ–΄ κ³„μ •μ„ ν†µν• μ§€μ†μ„± μ μ§€
ConnectWise Control (κµ¬ ScreenConnect)μ„ μ„¤μΉ ν›„ μ§€μ†μ„± μ μ§€
30/39

2. Cobalt Strike λΉ„μ½μ„ ν†µν• μ§€μ†μ„± μ μ§€
3. VPN μ·¨μ•½μ μΌλ΅ μ§€μ†μ„± μ μ§€
4. On-premise virtual desktop appliancesλ¥Ό ν†µν• μ§€μ†μ„± μ μ§€
5. Scheduled Taskλ¥Ό μ΄μ©ν•μ—¬ μ£ΌκΈ°μ μΌλ΅ μ•…μ„±μ½”λ“ μ‹¤ν–‰
6. μµμ΄ μΉ¨ν¬ ν›„ μ›Ήμ‰μ„ μ‚½μ…ν•μ—¬ μ§€μ†μ„± μ μ§€
7. REvil λμ„¬μ›¨μ–΄λ” μµμ…μ— λ”°λΌ λ¶€ν… μ‹ μλ™μ‹¤ν–‰ λλ„λ΅ λ μ§€μ¤νΈλ¦¬μ— λ“±λ΅

Privilege Escalation
1. CVE-2018β€“8453 μ·¨μ•½μ μ„ μ΄μ©ν•μ—¬ λ΅μ»¬ κ¶ν• μƒμΉ μ‹λ„
2. GPO(Group Policy Preferences)λ‚΄μ— ν¬ν•¨λ ν¨μ¤μ›λ“λ΅ λ΅κ·ΈμΈν•μ—¬ κ¶ν• μƒμΉ
3. λ‚΄λ¶€ λ§μ—μ„ μμ§‘ν• κ³„μ •μ •λ³΄λ¥Ό ν†µν•΄ κ¶ν• μƒμΉ μ‹λ„
4. Metasploitμ UAC-TokenMagic νμ›μ‰ μ¤ν¬λ¦½νΈλ΅ UAC μ°ν
5. Invoke-SluiBypass νμ›μ‰ μ¤ν¬λ¦½νΈλ΅ UAC μ°ν
6. REvil λμ„¬μ›¨μ–΄λ” SeDebugPrivilege κ¶ν•μ„ ν• λ‹Ήν•μ—¬ νƒ€ ν”„λ΅μ„Έμ¤μ— μ ‘κ·Ό μ‹λ„

Defense Evasion
1. rundll32.exe λΌλ” μ •μƒ ν”„λ΅μ„Έμ¤λ¥Ό μ΄μ©ν•μ—¬ μ•…μ„± DLL νμΌ μ‹¤ν–‰
2. BITSAdmin μ΄λΌλ” μ •μƒ λ„κµ¬λ¥Ό μ΄μ©ν•μ—¬ λ‚΄λ¶€μ— λμ„¬μ›¨μ–΄ λ°°ν¬
3. REvil λμ„¬μ›¨μ–΄λ” μµμ…μ— λ”°λΌ μ•μ „λ¨λ“λ΅ μ¬λ¶€ν…ν•μ—¬ νμΌ μ•”νΈν™”
4. GPO(Group Policy Preferences)λ¥Ό ν†µν•΄ Windows Defender λ° λ°±μ‹  λΉ„ν™μ„±ν™”
λ°°μΉ μ¤ν¬λ¦½νΈ μ‚¬μ©

Credential Access
1. Mimikatzλ¥Ό μ΄μ©ν•μ—¬ ν¬λ¦¬λ΄μ… μμ§‘
2. ProcDumpλ¥Ό μ΄μ©ν•μ—¬ lsass ν”„λ΅μ„Έμ¤ dumpλ¥Ό ν†µν•΄ ν¬λ¦¬λ΄μ… μμ§‘

Discovery
1. μλ„μ° κΈ°λ³Έ μ κ³µ λ…λ Ήμ–΄λ¥Ό ν†µν•΄ μ •λ³΄ νƒμƒ‰
net : λ„¤νΈμ›ν¬ κ³µμ  λ° μ›ν¬μ¤ν…μ΄μ… μ •λ³΄ μμ§‘
31/39

nltest : λ„λ©”μΈ μ»¨νΈλ΅¤λ¬ λ° μ‹ λΆ°ν•  μ μλ” λ„λ©”μΈ λ©λ΅ μμ§‘
ipconfig : κ°μ—ΌκΈ°κΈ° μ „μ²΄ IP μ •λ³΄ μμ§‘
systeminfo : κ°μ—ΌκΈ°κΈ° μ „μ²΄ μ‹μ¤ν… μ •λ³΄ μμ§‘
ping : icmp λ¥Ό ν†µν• ν¬νΈμ¤μΊ” μν–‰
2. Advanced Port Scanner λ„κµ¬λ΅ ν¬νΈ μ¤μΊλ‹ μν–‰
3. ADReconμ„ μ΄μ©ν•μ—¬ Active Directory μ •λ³΄ μμ§‘
4. Everythingμ„ μ΄μ©ν•μ—¬ μ‹μ¤ν… λ‚΄ μ£Όμ” νμΌ μ •λ³΄ μμ§‘
5. PoS Software μ„¤μΉ μ—¬λ¶€ ν™•μΈ
6. SoftPerfect Network Scanner λ„κµ¬λ΅ λ‚΄λ¶€ λ„¤νΈμ›ν¬ μ¤μΊ”
7. Bloodhoundλ„κµ¬λ΅ LDAP μΏΌλ¦¬λ¥Ό μ΄μ©ν•μ—¬ Active Directoryμ •λ³΄ μμ§‘
8. ADfind λ„κµ¬λ΅ Active Directory μ •λ³΄ μμ§‘

Lateral Movement
1. Scheduled Task: μμ•½λ μ‘μ—…μ„ ν†µν•΄ μΈ΅λ©΄ μ΄λ™ μν–‰
2. PsExec: λ‚΄λ¶€ λ€μ—­μ— μ•…μ„±μ½”λ“ λ³µμ‚¬ ν›„ μ›κ²©μΌλ΅ μ‹¤ν–‰
3. Admin share: λ„¤νΈμ›ν¬ κ³µμ  κΈ°λ¥μΌλ΅ νμΌ λ³µμ‚¬ ν›„ μ‹¤ν–‰
5. WMIExec: WMI λ…λ Ήμ–΄λ¥Ό ν†µν•΄ λ‚΄λ¶€ λ€μ—­μ— μ•…μ„±μ½”λ“ λ³µμ‚¬ ν›„ μ‹¤ν–‰
6. CrackMapExec λ„κµ¬λ΅ μΈ΅λ©΄ μ΄λ™ μν–‰
7. RDP κ³„μ •μ„ μμ§‘ν•μ—¬ μΈ΅λ©΄ μ΄λ™ μν–‰
8. Cobalt Strike κΈ°λ¥μΌλ΅ SMBλ¥Ό ν†µν• μ›κ²© μ„λΉ„μ¤λ¥Ό μƒμ„±ν•μ—¬ μΈ΅λ©΄ μ΄λ™ μν–‰

Command and Control
1. Cobalt Strike λΉ„μ½μ„ ν†µν• κ°μ—ΌκΈ°κΈ° μ›κ²©μ μ–΄ μν–‰
2. Gootkit, Qbot, IcedId μ™€ κ°™μ€ μ λ…ν• μ•…μ„±μ½”λ“λ¥Ό ν†µν•΄ μ›κ²©μ μ–΄ λ…λ Ή λ° λμ„¬μ›¨μ–΄ λ‹¤μ΄λ΅λ“
3. Wgetμ„ ν†µν•΄ μ¶”κ°€ μ•…μ„±μ½”λ“ λ‹¤μ΄λ΅λ“
4. νμ›μ‰ μ¤ν¬λ¦½νΈλ΅ pastebinμ νΉμ • νμΌμ„ μ½μ–΄μ™€ λ””μ½”λ”© ν›„ μ‹¤ν–‰

Exfiltration
1. Rcloneλ„κµ¬λ¥Ό μ΄μ©ν•μ—¬ κ³µκ²©μμ μ›κ²© μ„λ²„λ΅ νμΌ λ³µμ‚¬

32/39

2. Mega ν΄λΌμ°λ“λ¥Ό μ΄μ©ν•μ—¬ νƒμ·¨ν• λ°μ΄ν„° μ €μ¥

Impacts
1. μ£Όμ” νμΌ μ•”νΈν™”
2. μ£Όμ” λ°±μ—… λ° μ•ν‹° λ°”μ΄λ¬μ¤ μ„λΉ„μ¤ μ¤‘μ§€
3. Volume Shadow Copy μ‚­μ 
4. VM Snapshot μ‚­μ 
5. File backup μ‚­μ 
6. μ¤‘μ”ν• λ¬Έμ„ μ‚­μ 

Conclusion
REvil λμ„¬μ›¨μ–΄λ” 2019λ…„ 4μ›”μ— μµμ΄ λ“±μ¥ν• μ΄ν›„, μ•½ 2λ…„μ΄ λ„λ” μ‹κ°„ λ™μ• λ‹¤ν¬μ›Ή λ‚΄
RaaS(Ransomware as a Service) μ‹μ¥μ—μ„ μµμ •μƒμ μλ¦¬λ¥Ό μ§€ν‚¤κ³  μλ‹¤. μ§€μ†μ μΈ λ²„μ „ μ—…λ°μ΄
νΈ, λ‹¤μ–‘ν• κΈ°λ¥ λ° μƒμ„Έ μµμ…μ„ ν†µν• μ‰¬μ΄ μ»¤μ¤ν„°λ§μ΄μ§•μ΄ κ°€λ¥ν•κΈ° λ•λ¬Έμ΄λ‹¤. λ‹¤μμ κµ¬λ§¤μλ“¤
(λλ” Operator)μ— μν•΄ κ°μΈλ¶€ν„° JBSμ™€ κ°™μ€ λ€ν• κΈ°μ—… κ³µκ²©μ—κΉμ§€ REvil λμ„¬μ›¨μ–΄λ¥Ό μ΄μ©ν• κ΄‘
λ²”μ„ν• κ³µκ²©μ΄ μ΄λ£¨μ–΄μ§€κ³  μλ‹¤.
REvilλ΅λ¶€ν„° νμƒλ μ΅°μ§λ“¤μ΄ κ³„μ† μƒκ²¨λ‚κ³ , μΈν„°λ·°λ¥Ό ν†µν•΄ μ•μΌλ΅ λ”μ± λ” μ κ·Ήμ μΌλ΅ κ³µκ²©ν• 
κ²ƒμ„μ„ λ°νκΈ°λ„ ν–λ‹¤. REvilμ€ λΈκ°’μ„ λ°›μ•„λ‚΄κΈ° μ„ν•΄ κΈ°μ—… μ •λ³΄ μ μ¶, DDoS, ννΈλ„μ‚¬ ν‘λ°• λ“±
κ³Ό κ°™μ€ μ „λµμ„ μ·¨ν•κ³  μκΈ° λ•λ¬Έμ— μ‹¤μ λ΅ κ°μ—Όλ  κ²½μ°, κΈ°μ—… λ‚΄ ν° νƒ€κ²©μ„ μ…μ„ μ μλ‹¤.
λμ„¬μ›¨μ–΄μ μ½”λ“λ” 2λ…„ λ™μ• ν¬κ² λ°”λ€μ§€ μ•μ•μ§€λ§, μ΄λ¥Ό μ‚¬μ©ν•λ” κ³µκ²©μλ“¤μ΄ λ§μ€ λ§νΌ λ§¤μ°
λ‹¤μ–‘ν• μµμ΄ μΉ¨ν¬ κ²½λ΅, κ³µκ²© λ„κµ¬λ΅ λ°°ν¬λκ³  μλ‹¤. κ·Έλ ‡κΈ° λ•λ¬Έμ— λμ„¬μ›¨μ–΄ μμ²΄μ— λ€ν•΄μ„λ§ λ€
μ‘ν•λ” κ²ƒμ΄ μ•„λ‹, μ „μ²΄μ μΈ κ³µκ²© μ‹λ‚λ¦¬μ¤λ¥Ό μ΄ν•΄ν•κ³  μμ‹  λλ” κΈ°μ—…μ μ·¨μ•½ν• λ¶€λ¶„μ„ ν™•μΈν•
μ—¬ μ κ²€ λ° λ³΄μ™„ν•  μ μμ–΄μ•Ό ν•λ‹¤.

Reference
1. https://blog.talosintelligence.com/2019/04/sodinokibi-ransomware-exploits-weblogic.html
2. https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/sodinokibiransomware-cobalt-strike-pos
3. https://blog.amossys.fr/sodinokibi-malware-analysis.html
4. https://www.tgsoft.it/immagini/news/20190705Sodinokibi/Sodinokibi_eng.pdf
5. https://i.blackhat.com/eu-20/Wednesday/eu-20-Clarke-Its-Not-FINished-The-EvolvingMaturity-In-Ransomware-Operations.pdf

33/39

6. https://blog.malwarebytes.com/threat-analysis/2020/11/german-users-targeted-with-gootkitbanker-or-revil-ransomware/
7. https://asec.ahnlab.com/ko/19640/
8. https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/

Appendix
Appendix #1 : REvil λμ„¬μ›¨μ–΄ νƒμ§€ μ•ΌλΌ λ£°
rule REvil_Ransomware_V2_5{
meta:
description = "REvil ransomware v2.05
detection rule"
author = "S2WLAB TALON"
date = "2021-06-23"
version
= "1.0"
strings:
$pattern1 = "ERR0R D0UBLE RUN!" ascii wide nocase
$pattern2 = "vmcompute.exe" ascii wide nocase
$pattern3 = "vmms.exe" ascii wide
nocase
$pattern4 = "vmwp.exe" ascii wide nocase
$pattern5 = "svchost.exe"
ascii wide nocase
$pattern6 = "DTrump4ever" ascii wide nocase
$pattern7 =
"expand 32-byte k" ascii wide nocase
$pattern8 = "expand 16-byte k" ascii wide
nocase
$pattern9 = "__ProviderArchitecture" ascii wide nocase
$code1 = {83
EC 10 B9 5B 04 00 00 53 56 8B 75 08 [0-8] C1 E6 10 33 75 08 81 F6 ?? ?? ?? ?? 8B C6 C1
E8 15 57}
$code2 = {8B 55 08 40 0F B6 C8 8B 45 08 89 4D 10 8B 5D 10 8A 0C 01 0F
B6 C1 03 C6 0F B6 F0 8B 45 08 8A 04 06 88 04 13 8B C2 8B D3 8B 5D 14 88 0C 06 0F B6 04
02 8B 55 0C 0F B6 C9 03 C8 0F B6 C1 8B 4D 08 8A 04 08 32 04 1A 88 03 43 8B 45 10 89 5D
14 83 EF 01 75} // rc4
condition:
( 8 of ($pattern*) and $code1 ) or
(
8 of ($pattern*) and $code2 )}rule REvil_Ransomware_V1_6{
meta:
description =
"REvil ransomware v1.06 detection rule"
author = "S2WLAB TALON hypen"
date
= "2021-06-23"
version = "1.0"
strings:
$pattern1 = "ServicesActive"
ascii wide nocase
$pattern2 = "expand 32-byte k" ascii wide nocase
$pattern3 = "expand 16-byte k" ascii wide nocase
$code1 = {11 f8 90 45 3a 1d d0
11 89 1f 00 aa 00 4b 2e 24 28 20 bd 49 23 15 d1 11 ad 79 00 c0 4f d8 fd ff 87 a6 12 dc
7f 73 cf 11 88 4d 00 aa 00
4b 2e
24} // rscid
$code2 = {8B 55 08 40 0F B6
C8 8B 45 08 89 4D 10 8B 5D 10 8A 0C 01 0F B6 C1 03 C6 0F B6 F0 8B 45 08 8A 04 06 88 04
13 8B C2 8B D3 8B 5D 14 88 0C 06 0F
B6 04 02 8B 55 0C 0F B6 C9 03 C8 0F B6 C1 8B 4D
08 8A 04 08 32 04 1A 88 03 43 8B 45 10 89 5D 14 83 EF 01 75} // rc4
condition:
all of them}

Appendix #2 : Sigma rule
μ¶μ² : https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/
https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_pow
ershell_enc_cmd.yml
https://github.com/Neo23x0/sigma/blob/084cd39505861188d9d8f2d5c0f2835e4f750a3f/rules/wi
ndows/process_creation/win_malware_trickbot_recon_activity.yml
https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_com
mands_recon_activity.yml

34/39

https://github.com/SigmaHQ/sigma/blob/master/rules/windows/network_connection/sysmon_ru
ndll32_net_connections.yml
https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_process_c
reation_bitsadmin_download.yml
https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_adfi
nd.yml
https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_wmi
_execution.yml
https://github.com/SigmaHQ/sigma/blob/a08571be9107d1c0e216400ffbb89c394fcd2570/rules/
windows/process_creation/win_office_shell.yml

Appendix #3 : IoC
Click the below image then redirect to google spreadsheet
μ¶μ² : Referenceμ— λ…μ‹λ λ¶„μ„ λΈ”λ΅κ·Έ λ‚΄ IoC μ·¨ν•©

35/39

Appendix #4 : REvil ν‘μƒ μ‚¬μ΄νΈ νμ΄μ§€ (μµμ΄ Key μ…λ ¥ λ° μΊ΅μ°¨ μ λ„)

36/39

37/39

Appendix #5 : v2.05μ™€ v2.07 λΉ„κµ
ν„μ¬κΉμ§€ λ°κ²¬λ REvil λμ„¬μ›¨μ–΄μ κ°€μ¥ μµμ‹  λ²„μ „μ€ 2.07λ΅ ν™•μΈλ¨
1. λ΅μ»¬ λ“λΌμ΄λΈ μ•”νΈν™”
2.07 λ²„μ „μ—μ„λ” λ΅μ»¬ λ“λΌμ΄λΈ μ•”νΈν™” μ‹, λ“λΌμ΄λΈ νƒ€μ…μ΄ DRIVE_FIXED(μΌλ° λ””μ¤ν¬)
μΌ κ²½μ°, NetShareAdd ν•¨μλ΅ λ΅μ»¬ κ³µμ  μ‹μ‘
NetShareAdd ν•¨μλ¥Ό μ΄μ©ν• κ°μ—Ό λ‹¨λ§ λ¦¬μ†μ¤ κ³µμ μ‹ μ‚¬μ©λλ” comment
(SHARE_INFO_2 κµ¬μ΅°μ²΄ λ‚΄ shi2_remark λ©¤λ²„ λ³€μ) λ¬Έμμ—΄ : β€Share added by Rβ€

38/39

2. λ„¤νΈμ›ν¬ λ“λΌμ΄λΈ μ•”νΈν™”
2.07 λ²„μ „μ—μ„λ” λ„¤νΈμ›ν¬ λ“λΌμ΄λΈ μ•”νΈν™” ν•¨μλ¥Ό Threadλ΅ μƒμ„±ν•μ§€ μ•μ
κΈ°μ΅΄μ—λ” explorer.exeμ ν† ν°μ„ impersonateν•μ—¬ λ„¤νΈμ›ν¬ κ³µμ  νƒμƒ‰ κ¶ν•μ„ νλ“ν•μ€λ”
λ°, 2.07 λ²„μ „μ—μ„λ” μ΄μ— λ”ν•΄ ν„μ¬ Threadλ¥Ό μ μ™Έν• ν„μ¬ ν”„λ΅μ„Έμ¤ λ‚΄ λ¨λ“  Threadμ— λ™
μΌν• ν† ν° μ μ©
μ΄ν›„ λ³µμ λ ν† ν°μΌλ΅ λ„¤νΈμ›ν¬ λ“λΌμ΄λΈ μ•”νΈν™”λ¥Ό μ‹λ„ν•κ³ , RevertToSelfλ΅ impersonate
μΆ…λ£ ν›„μ— ν•λ² λ” λ„¤νΈμ›ν¬ λ“λΌμ΄λΈ μ•”νΈν™”λ¥Ό μ‹λ„ν•¨

39/39