How take control of All your Systems

Silent RIFLE : Response Against Advanced Threat
HackCon : The Norwegian Cyber Security Convention

HackCon : The Norwegian Cyber Security Convention

#About Me

Kyoung-Ju Kwak (郭炅周)
Manager, Threat Analysis Team

Currently working on FSI (Financial Security Institute) Threat Analysis Team
=> FSI (Financial Security Institute, Public Company) covers 200 financial companies in South Korea
Currently, Member of National Police Agency Cyber-Crime & Threat Intelligence Advisory Committee
Minister of Interior's Excellence Award, National Cyber Security Awards 2016

Highlighted Talks
1. The Case study of Incidents in Korea Financial Sector, International Symposium on Cyber Crime Response, 2014
2. Financial Security, Whitehat Contest, 2015
3. Ransomware Overview, SungKyunKwan University, 2016
4. The New Wave of CyberTerror in Korea Financial Sector, PACSEC Tokyo, 2016
5. Fly me to the BLACKMOON, HITCON Taiwan, 2016
6. Kaspersky SAS (Security Analyst Summit, St.Maarten), 2017 (TBE)
HackCon : The Norwegian Cyber Security Convention

CONTENTS

01. Background Knowledge
02. RIFLE Campaign
03. Correlation Analysis
04. Summary & Conclusion

HackCon : The Norwegian Cyber Security Convention

01

Background Knowledge

HackCon : The Norwegian Cyber Security Convention

Background Knowledge

A Piece of Rifle Campaign
https://www.operationblockbuster.com

Blockbuster Operation
Threat Actor : Lazarus Group

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

Background Knowledge

http://www.symantec.com/connect/blogs/attackers-target-dozens-global-banks-new-malware-0
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

Background Knowledge

http://baesystemsai.blogspot.no/2017/02/lazarus-watering-hole-attacks.html
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

Background Knowledge

20th Mar, 2013

3.20 Cyber-terror (A.K.A DarkSeoul)

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

Background Knowledge

3.20 Cyber-terror (A.K.A DarkSeoul)

Patch Management Servers were controlled over by attackers
Lots of PCs and Servers were shutdown at the same time (20th March, 2013)
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

Background Knowledge - 3.20 Cyber-terror (A.K.A DarkSeoul)

Victims : Major 3 Banks and Major 3 Broadcasting Companies in South Korea
Almost 16,000 CD/ATM and 26,000 PCs & Servers totally Unusable

KBS staff member’s Laptop Screen
damaged by 3.20 Cyber-terror

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

Cyberterrors in South Korea

Cyberterror Timeline in 2016
Feb
Feb
Mar
Mar
Mar
July
Aug
Nov
Nov
Dec

Fake Softcamp DRM Solution
Malware using Valid Codesigning Certificate of Initech
MLSoft tco!stream Vulnerability
Nicstech SafePC Vulnerability : Season 1
Malware using Valid Codesigning Certificate of IBLeaders
Personal Data Breach - Interpark Online Mall
Blacksheep Operation
Spearing-Hole attack using Initech’s Valid Codesign Certificate
Nicstech SafePC Vulnerability : Season 2
Military Cyber Command Cyber-terror
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

Cyberterrors in South Korea

Trend of Cyber-terror in 2016
Focusing on 3rd party IT Solution Provider
installed on Conglomerates

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

02

RIFLE Campaign

HackCon : The Norwegian Cyber Security Convention

RIFLE Campaign

3.20 Cyber-terror (DarkSeoul)

ADEX Operation

BlackMine Operation

Softcamp DRM Malware

Fake Initech Malware

Rifle
Campaign
Military Cyber Command Cyber-terror

Blacksheep Operation

MLSoft tco!stream Vulnerability

Nicstech SafePC Vulnerability

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign
15th Feb, 2016

SoftCamp DRM Malware Discovered
16th Feb, 2016

Initech Malware Discovered
- dubbed “Rifle Malware”
17th Feb, 2016

Interesting Decoding Method Discovered
Mar, 2016

Correlation between Initech Malware and Past Incidents Discovered
Mar, 2016

Dubbed RIFLE Campaign
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Classification
Type
Rifle

Features
Download additional malware (sec.exe)

PDB (Program Data Base) Path
E:\Data\My Projects\Troy Source
Code\tcp1st\rifle\Release\rifle.pdb

Sniffer

Send Infected PC’s information to C&C Server

E:\Data\My Projects\Troy Source
Code\tcp1st\sniffer - Copy\Release\dll_like_exe.pdb

Server

Installed on C&C Server and communicate with
Rifle and Sniffer

E:\Data\My Projects\Troy Source
Code\tcp1st\server\Release\server.pdb

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

Related Cases
HackCon : The Norwegian Cyber Security Convention

RIFLE Campaign

Rifle Campaign - Initech Malware
Sample Information
File Name

MD5

File Type

iniSignCrypto.dll

C2A171716FF72B8C8965DFB3CD3ECCFF

DLL

ECA2DFAA11ED41F119346E333B5D8461

EXE

275B7AF66726950A895FBD74C6227CAB

EXE

iniwebssocrypto.exe

40+ Variants

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - Initech Malware
Certification Path

Abusing Valid Certificate
stolen from IT Solution Company “Initech”

Certificate status
This certificate is OK

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - Initech Malware

Issued to:
Issued by:
Valid from

to

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - Initech Malware
Flow

{

create and execute guifx.exe
/run not exist Autorun Registry
create Mutex -> ASDASDASDSA

{ {

Check Exec Args

/run exist

communicate /w C2

Not Identified

{

0x1055 : Create Additional Malware (sec.exe)

Get CMD from C2

{

Gathering infected system’s info

0x2746, 0x2744 : Waiting for C2 Command

Username
Computername
OS Version
Network Adapter Info

Send it to C2

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - Initech Malware
C&C Servers
IP

Country

Allocated

192.99.223.115:80

Canada

Unknown

165.194.123.67:443

Republic of Korea

Jung-Ang University

Republic of Korea

Catholic Chant &
Contemporary Music
Internet Broadcasting
(caccm.org)

175.117.144.67

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - Initech Malware
Created File
C:\Program Files\Common Files\Graphics\guifx.exe
Mutex
ASDASDASDSA, MUTEX394039_4830023
PDB Path
E:\Data\My Projects\Troy Source Code\tcp1st\rifle\Release\rifle.pdb
E:\Data\My Projects\Troy Source Code\tcp1st\sniffer - Copy\Release\dll_like_exe.pdb
E:\Data\My Projects\Troy Source Code\tcp1st\server\Release\server.pdb
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - ADEX Spearphishing
ADEX
Seoul International Aerospace & defense Exhibition
Spearphishing, target Military Defense Industry

Samsung Thales
Samsung Techwin
Agency for Defense Development
Doosan DST (Defense Systems & Technology)
Hanhwa Defense
LG CNS
LIG Nexone

Email Attachment
(Weaponized macro document)
=> ADEX Participants List
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - ADEX Spearphishing
From : ADEX Steering Committee
To : xxxxx@lignex1.com
Contents
We provide participants list as an attachment.
If you’re not able to open Excel file, please
enable Macros in Excel.
Thanks.
Attachment
2015 Seoul Airshow Result and Participants list.xls

Disguised as ADEX Steering Committee

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - ADEX Spearphishing
Macro

Obfuscated

After Deobfuscating
Sub 0x1
http://158.69.115.115/help.php
ahnLab.exe

* ahnlab = Well-known local Antivirus Vendor in SouthKorea

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - ADEX Spearphishing
ahnLab.exe
File Name

MD5

File Type

ahnLab.exe

62FDF4822431D4C82B78E602AB3558AD

EXE

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - ADEX Spearphishing
Comparison : iniWebSSOCrypto.exe & ahnLab.exe

Same PDB Path
E:\Data\My Projects\Troy Source
Code\tcp1st\rifle\Release\rifle.pdb

<iniWebSSOCrypto.exe>

<ahnLab.exe>
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - ADEX Spearphishing
Comparison : iniWebSSOCrypto.exe & ahnLab.exe
Similar WinMain Function

<ahnLab.exe>
<iniWebSSOCrypto.exe>

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - ADEX Spearphishing
Comparison : iniWebSSOCrypto.exe & ahnLab.exe

Same Created Filename

GUIFX.exe

<iniWebSSOCrypto.exe>

<ahnLab.exe>
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - ADEX Spearphishing
Comparison : iniWebSSOCrypto.exe & ahnLab.exe
Same Autorun Registry Path
Software\Microsoft\Windows\CurrentVersion\Run\Graphics\guifx.exe /run

<ahnLab.exe>
<iniWebSSOCrypto.exe>

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - ADEX Spearphishing
Comparison : Initech Malware Variant & ahnLab.exe
Same C&C Server

175.117.144.67
<Initech Malware Variant>

<ahnLab.exe>

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - How they hacked Initech and stole Certificates
“Nicstech” DLP Solution Vulnerability
※ DLP : Data Loss Prevention

Initech uses this solution for internal security
and 67 financial companies also use this solution
including my company, FSI

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - How they hacked Initech and stole Certificates
“Nicstech” DLP Solution Vulnerability

0day Vulnerability
File transfer & Remote Command Execution
(Encryption Key was hardcoded)
Vulnerable Port : 5560/tcp

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - How they hacked Initech and stole Certificates
“Nicstech” DLP Solution Vulnerability
File Transfer &
Command Execution
by using Nicstech Vuln

Lateral Movement
to
Build Server

ATTACKER
Product Source code
& Code-signing
Certificate Leaked

Initech Internal Network
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - SoftCamp DRM Malware
Sample Information

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - SoftCamp DRM Malware
Sample Information
Dropper
File Name
Unknown (Dropper)
Unknown (Dropper)

MD5
741FADDA07D9C2E41D6D8B0F2E91BC5E
EE778BE503FDA770EE2F40E51EDFD595

File Type
EXE
EXE

File Name

MD5

File Type

SDSLogin.exe

33E09CF92DD8AB4F75DAC20E088A5709

EXE

kbinst.exe

BB710DB1C03EBC4F8D6EBB8B8577EE78

EXE

SDSinst.exe

5CA4562A5BFA15417707D3168161CB23

EXE

wsupdatemgr.dll

A1F92B84614D7F07AB84C7A97675B299

DLL

Dropped Files

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - SoftCamp DRM Malware
Flow

{ {
SDSLogin.exe

Dropper

kbinst.exe
or
SDSinst.exe

Not Identified

1) Delete wsupdatemgr service and SDSDec.dll
2) Create kbinst.log (IP and Sysinfo from infected system)

Send it to C2

1) Create ud.bat to delete SDSInst.exe itself
2) Drop wsupdatemgr.dll
3) Launch service with wsupdatemgr.dll by using svchost.exe

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - SoftCamp DRM Malware > C&C Server
C&C Servers
IP

Country

Allocated

165.194.117.35

Republic of Korea

Jung-Ang University

203.241.248.108

Republic of Korea

In-Jae University

124.139.210.45

Republic of Korea

Unknown

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - GhostRat Operation

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - GhostRat Operation
Start from C&C Server of Softcamp DRM Malware

Softcamp Malware C&C Server
Transfer Data

203.241.248.108
In-Jae University

Data Breach

210.xxx.xxx.241
(Central C&C Server)

0day Attack

ATTACKER
175.117.144.67

Victims (SK Group, Hanjin, Korea Airline, KT)
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - GhostRat Operation
Damage
➊ Stolen Documents : 1TB / 42,600 files
➋ 140,000 PCs of 27 companies infected
➌ Victimized companies
- Defense industry : Hanjin Group affiliates (Korean Air)
- Telecommunications networks : 17 SK Group affiliates, KT
- They’re all Conglomerates

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - How they hacked Victims
TCO!Stream Vulnerability - 0day until March. 2016
TCO!Stream : PC asset management system
Desktop Integrated management software that manages all the PCs connected to
the network. Some of its functions include various types of error management,
hardware management, software management, software installation and upgrade
and illegal software check-up.

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - How they hacked Victims
TCO!Stream Modules
Filename

Service Port

Functionality

EtcCmds.exe

3511

TCO!stream Server Health Check

TXFercli.exe

3523
3524

Administrator can control Client PCs remotely
File Transfer & Receive, Deletion, Execution

tsrvctl_nt.exe

3526

Remotely File/Command Execution

3511

TCO!stream Client Main Module
Module Update, PC Information Gathering

TClient.exe

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - How they choose Targets and How FSI detected it

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - How they choose Targets and How FSI detected it

Vulnerable Port Scan
FSI Security Operations Center
detected abnormal scan events
3511 TCP Port scan (12/Jan/2016)

Source : 175.117.144.67 (Korea)
Destination : 67 Financial Companies
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Rifle Campaign - Military Cyber Command (MCC) Incidents
3,200 PCs Infected

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

03

Correlation Analysis

HackCon : The Norwegian Cyber Security Convention

RIFLE Campaign

Correlation Analysis : Trace their Footprints

Decoding or Encoding Method
- Decoding Code, Decoding Key
PDB Path
C&C Server
- Server IP and Command Code
Font (If Document malware)

Used Vulnerability
Created Files
Created Process
Registry
Internal String
MUTEX

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Correlation Analysis

{}
Yara

/* YARA */

&

Maltego
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Correlation Analysis
Font
https://kevinchen.co/blog/installing-north-korea-red-star-os/

<Social Engineering Targets>
[NAME]

Frequently Used Fonts
DengXian, DengXian Light
KP CheongPong, KP CheonRiMa,
KP KwangMyeong

[EMAIL]

Chinese Fonts
RedStar OS Fonts
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Correlation Analysis : RIFLE Campaign
Decoding Method : IDA PseudoCode

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Correlation Analysis
XOR Key

Be careful with Endian

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Correlation Analysis
PDB Path, C&C Server, Dropped Filename, Code Similarity

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

RIFLE Campaign

Correlation Analysis - Relationship Overall (Maltego)

HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

05

Summary & Conclusion

HackCon : The Norwegian Cyber Security Convention

Summary & Conclusion

Cyber Attack in South Korea
- Too busy from last year, even until YESTERDAY!
- Massive Cyber Attack still on going and will Keep going
- Attackers continuously try to find Vulnerability of 3RD Party Security Solutions

Correlation Analysis
- Know your enemies and Draw a Big Picture
- Build a Strategy and Tactics to response against Advanced Threat in the Future

More We Share, More We Find Out
HackCon : The Norwegian Cyber
Security
Convention
HITCON
Pacific
2016

Thank You
kjkwak@fsec.or.kr
skype, hangout : kjkwak12@gmail.com

HackCon : The Norwegian Cyber Security Convention