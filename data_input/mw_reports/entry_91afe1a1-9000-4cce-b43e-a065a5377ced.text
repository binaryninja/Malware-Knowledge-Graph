11/29/2018

360威胁情报中心

返回 TI 主页

RESEARCH

数 据 驱 动 安 全

Analysis Of Targeted Attack Against Pakistan By Exploiting
InPage Vulnerability And Related APT Groups
By 360威胁情报中心 | 事件追踪

Overview

Recently, 360 Threat Intelligence Center found a series of targeted attacks against Pakistan targets.
Attacker exploited one vulnerability (CVE-2017-12824) of InPage to craft bait documents (.inp). InPage is a
word processing software designed speciﬁcally for Urdu speakers (oﬃcial language in Pakistan). In
addition, Oﬃce documents with CVE-2017-11882 vulnerability were also used in the attack. Kaspersky
disclosed one target attack in which InPage vulnerability was exploited in November 2016[6] . However, ﬁrst
attack by using such software vulnerability can be traced back to June 2016[14].
Through the analysis of this group of documents with InPage vulnerabilities and related attack activities,
we can conclude that the attacker is BITTER APT organization disclosed by us in 2016 [5] . After further
analysis, some samples in the attack have strong connections with some APT groups, speciﬁcally
Patchwork, Bahamut, and Confucius. That shows more connections among those 4 APT groups from South
Asian.

Timeline

360 Threat Intelligence Center sorts out the timeline of targeted attacks in which InPage vulnerability
was exploited in the past two years as following:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

1/32

11/29/2018

360威胁情报中心

InPage Vulnerability Analysis (CVE-2017-12824)

The scan result of documents with InPage vulnerability on VirusTotal:

InPage is a word processing software specially designed for Urdu speakers, and the vulnerability
number involved in the wild attack sample is CVE-2017-12824.
After the analysis of the vulnerability by 360 Threat Intelligence Center, it was found that the
vulnerability was caused by the fact that InPage word processing software did not check the data type
(Type) to be processed when it is processing document ﬂow, which led to the out-of-bounds reading.
Through carefully constructed InPage document, arbitrary code could be triggered to execute.
https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

2/32

11/29/2018

360威胁情报中心

We used InPage 2015 software environment to analyze the vulnerability in detail, and the process is as
follows.
InPage 2015

Cause of Vulnerability: Out-of-bound Read

The essence of the CVE-2017-12824 vulnerability is out-of-bound Read. The InPage word processor
does not check the data type to be processed while processing the InPage100 stream in the document, and
the data type to be processed is speciﬁed by a ﬁeld in the InPage document. This allows an attacker to
cause an InPage program to make an out-of-bounds read error by setting a value outside the Type range.
The key data structures that trigger the vulnerability in document (.inp) are as follows. 0x7E and 0x72
represent a class of type in the document stream to be processed. We mark 0x7E as Type1 and 0x72 as
Type2:
InPage processes a.inp ﬁle as follows:
InPage ﬁrst calls Ole!The StgCreateDocﬁle function parses the entire.inp ﬁle and then calls Ole!
COleStreamFile: : OpenStream open InPage InPage100 data ﬂow in the document:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

3/32

11/29/2018

360威胁情报中心

All the processing logic related to the InPage100 stream will be carried out in PraseInPage100_432750
function, and the data in the stream will be read with the callback function InPage100Read_440ED0:

The trigger vulnerability Type data, 0x7E and 0x72 mentioned earlier, is eventually processed by the
function sub_453590.The buf in the ﬁgure below reads the data containing Type by calling
InPage100Read_440ED0:
The vulnerability function sub_453590 will select the corresponding processing process according to
Type1 and Type2 (0x7E and 0x72 bytes). First, it reads the function pointer array according to Type1, then
reads the function from the function pointer array according to Type2, and ﬁnally calls the function to
process data:
Let's look at the assignment and range of dword_656A28 in the ﬁgure above:

Type1 = ECX(0x1F8)>>2 = 0x7E(126), Type2 = EDI(0x72) :
Find the assignment of dword_656A28[0x7E] through IDA Pro:
https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

4/32

11/29/2018

360威胁情报中心

You can see that the actual size of the dword_656E60 array is 30 (0x1E) :
Since the size of Type2 in the vulnerability document is set to 0x72, EDI=0x72, but the InPage does not
judge the size of Type2 passed in, this will result in access to dword_656E60[0x72], and because
0x72>30(0x1E), an out-of-bounds read error occurs.

The Exploitation

Since the attacker sets Type2 in the document to 0x72, after addressing calculation, the code at the
function address 0x00455AFA will be accessed across the line:

You can see that dword_656E60[0x72] (0x455AFA) is just a pop retn instruction:

The pop retn instruction sequence plays a role as "jump" address, when performing Type related
processing function, due to the incoming parameters (pointer: 0 x031e383f) pointing to a data InPage
document ﬂow, an attacker can ﬁll the controllable data ﬂow with ShellCode, so after the pop retn
instructions will be returned directly to the attacker set ShellCode executed:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

5/32

11/29/2018

360威胁情报中心

However, the InPage program does not turn on DEP and ASLR protection, which results in ShellCode
being directly executed:

Analysis of Four Types of Attack Framework Using InPage Vulnerability

360 Threat Intelligence Center conducted analysis on the samples with InPage vulnerabilities in
Pakistan, found that a number of samples generated time, size, initial ShellCode InPage100 document ﬂow
and related ﬂow label all consistent. We can conﬁrm that those samples come from same source.

Through the analysis of this batch of InPage vulnerability utilization documents and relevant malicious
code, we found that the malicious code carried by the vulnerability documents used four diﬀerent types of
attack frameworks: four types of completely diﬀerent backdoor programs. The analysis is as follows.

WSCSPL:Full - featured Backdoor

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

6/32

11/29/2018

360威胁情报中心

A decoy document captured by 360 Threat Intelligence Center is called "SOP for Retrieval of Mobile
Data Records. Inp" (SOP for Mobile Data Records Retrieval). Cve-2017-12824 vulnerability utilization
document will eventually download and execute a full-featured back door program named WSCSPL.
Relevant vulnerability utilization document information is as follows:
MD5
The ﬁle name

863f2bfed6e8e1b8b4516e328c8ba41b
For Retrieval of Mobile Data Records, SOP for Retrieval of Mobile Data Records. Inp

ShellCode
After the bug is successfully triggered, ShellCode will locate the main function ShellCode by searching
the special logo "27862786". Then it will download Payload from khurram.com.pk/js/drv and save it to
c:\conf\ smss.exe for execution:
Downloader
MD5
Compile time
PDB path

c3f5add704f2c540f3dd345f853e2d84
2018.9.24
C: \ Users \ Asterix \ Documents \ 28 novdwn VisualStudio2008 \ Projects \ \ Release \ 2
8 novdwn PDB

The downloaded EXE ﬁle is mainly used to communicate with C2 and obtain the executables of other
modules. After execution, the registry key value (key: HKCU\Environment, key value: AppId, data: c:\ Intel
\drvhost. EXE) will be set ﬁrst.

Persistence is achieved by adding itself to the registry bootstrap:
And determine whether the current process path is c:\ Intel \drvhost. Exe, if not, copy itself to the path
and execute:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

7/32

11/29/2018

360威胁情报中心

When the process path meets the conditions, the machine GUID, computer user name and other
information obtained from the registry are encrypted and concatenated into a string:

Then send the constructed string to communicate with C2:nethosttalk.com and get the command to
execute again:
In this case, the C2 server returns an AXE:# instruction. The native program determines whether the
instruction is an AXE:# or an AXE.

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

8/32

11/29/2018

360威胁情报中心

If "AXE:#" is followed by the string content, the plug-in is downloaded and executed

In the process of debugging and analysis by 360 Threat Intelligence Center analysts, we successfully
obtained an executable plug-in named "WSCSPL" :
Backdoor - WSCSPL
MD5
Compile time
Original ﬁle name

1c2a3aa370660b3ac2bf0f41c342373b
2018.9.13
Exe winsvc.

This Trojan has same functionality as the Trojan used by Patchwork APT group disclosed by us in
2016[5]. The Trojan supports 17 commands, including uploading a list of hard disk, ﬁnding, reading,
creating a speciﬁed ﬁle, enumerating a list of processes, and ending a speciﬁed process. Trojan function
analysis is as follows:
Set two 10-second interval timers after the Trojan program runs:

Timer 1: request the IP of C&C:wcnchost.ddns.net. If the request is successful, save the IP to the
global variable and set the id variable to 1.

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

9/32

11/29/2018

360威胁情报中心

Timer 2: check the value of the identifying variable, if 1, try to connect C&C:

Then create two threads:

Thread 1: detects the connection status with C&C and receives the C&C command executable if the
connection is successful

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

10/32

11/29/2018

360威胁情报中心

Thread 2: checks whether the global variable dword_C9618 has data, and if so, sends the data to
C&C
The command execution code snippet is as follows:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

11/32

11/29/2018

360威胁情报中心

Trojan’s all commands and corresponding functions are shown in the following table:

3000
3001
3002
3004
3005
3006
3007
3009
3012
3013
3015
3016
3017
3019
3021
3032
3023
3025

Get RAT status information
Get computer hard disk information
Gets the list of ﬁles in the speciﬁed directory
Get RAT log 1
Create the speciﬁed ﬁle
Writes data to the create ﬁle
Open the speciﬁed ﬁle
Reads the contents of the speciﬁed ﬁle
Create remote console
Execute remote commands
Get RAT log 2
End remote console
Closes the speciﬁed handle
Gets a process that has an UPD active link
Get RAT log 3
End the speciﬁed process
Gets process information in the system
Get RAT log 4

Visual Basic Backdoor

Another captured vulnerability exploit document, CVE-2017-12824 named ‘AAT national assembly
ﬁnal.inp’, drop the backdoor written by Visual Basic.
Relevant vulnerability document information is as follows:
MD5
The ﬁle name

ce2a6437a308dfe777dec42eec39d9ea
The AAT national assembly ﬁnal. Inp

ShellCode
First, ShellCode triggered by the vulnerability locates the main ShellCode through the memory global
search string "LuNdLuNd" :

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

12/32

11/29/2018

360威胁情报中心

Locate the main ShellCode and get the API functions you want to use, and ensure that only one
instance runs by creating the mutex "QPONMLKJIH" :

Then extract a DLL module contained in the document and execute it by memory loading:

Dropper
MD5
The PDP path

43920ec371fae4726d570fdef1009163
C: \ users \ mz \ documents \ visualstudio2013 \ Projects \ Shellcode \ Release \ Shellcod
e PDB

The DLL ﬁle loaded in memory is a Dropper, which contains two resource ﬁles, "Bin" and "Bin2" :

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

13/32

11/29/2018

360威胁情报中心

Bin ﬁle is the back door program written by Visual Basic, while Bin2 is the normal inp decoy ﬁle
released and opened after the vulnerability is triggered. The contents of relevant decoy documents are as
follows:

Backdoor - SMTPLDR. Exe
MD5
Compile time
Original ﬁle name

694040b229562b8dca9534c5301f8d73
2018.7.4
Exe SMTPLDR.

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

14/32

11/29/2018

360威胁情报中心

Bin ﬁle is a backdoor program written by Visual Basic, which is mainly used to obtain command
execution. After the Trojan horse runs, it ﬁrst gets the installed application name of the current system
from "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\" :

Then determine whether the installed application includes kaspersky, NORTON, trend technology and
other related software killing applications:

Then WMI executes the select * from win32_computersystem command to get the application
information and detect the virtual machine environment by determining whether the word "virtual" is
included in the name:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

15/32

11/29/2018

360威胁情报中心

If the detection is in the virtual machine environment, the popover displays not a valid ﬁle and exits:

If the detection passes, "SMTP Loader. LNK" will be created in the directory of %Start% to achieve
self-startup:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

16/32

11/29/2018

360威胁情报中心

Finally, it communicates with C&C: referﬁle.com to obtain subsequent instruction execution:

Delphi Backdoor Program

360 Threat Intelligence Center found a batch of backdoor written by Delphi through big data
correlation, which are also documents with InPage vulnerability. Relevant sample information is as follows:
MD5
Original ﬁle name

fec0ca2056d679a63ca18cb132223332
Exe adobsuit.

The captured Delphi backdoor is the same as the backdoor written by Visual Basic, which is also
released from the resource ﬁle by similar Dropper and created by creating Adobe creative suit. LNK ﬁle in
the directory of %Start% and pointing to the implementation of persistence:

The backdoor will Ducument in % % folder to create the users. The TXT ﬁle, and random write 30
bytes of the string:
https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

17/32

11/29/2018

360威胁情报中心

Trojan program will access to a computer user name and the computer user name after encrypting the
Ducument to % % / SyLog. The log ﬁle:

After that, I communicated with C2:errorfeedback.com and sent the contents of sylog.log ﬁle as POST:

When C2 returned to Success, and C2 communication in the form of HTTP GET request again, if return
a string, continued to from "errorfeedback.com/ MarkQuality455
TTGKWoFdyQHEwpyYKmfVGtzQLfeqpJ/string" perform download the following content:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

18/32

11/29/2018

360威胁情报中心

A Backdoor Using Cobalt Strike

Another captured InPage vulnerability exploit document ends up executing a backdoor generated by
Cobalt Strike, with the following documentation information:
MD5
The ﬁle type
Find the time

74aeaeaca968ﬀ69139b2e2c84dc6fa6
InPage vulnerability exploit documentation
2018.11.02

ShellCode
After the vulnerability is successfully triggered, ShellCode ﬁrst locates the main ShellCode with the
special identiﬁer "LuNdLuNd", and then loads the attached DLL in memory and executes.
Dropper
MD5
ec834fa821b2ddbe8b564b3870f13b1b
C: \ users \ mz \ documents \ visualstudio2013 \ Projects \ Shellcode \ Release \ Shellcod
PDB path
e PDB
Memory loaded DLL ﬁle and the above Visual Basic/Delphi back door, is also from the resources to
release Trojan ﬁles and execute:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

19/32

11/29/2018

Downloader - winopen. Exe
MD5
Compile time

360威胁情报中心

09d600e1cc9c6da648d9a367927e6bﬀ
2018.10.12

Release the Downloader executive called winopen. Exe, it will get a normal JPEG ﬁle header from
jospubs.com/foth1018/simple.jpg encrypted ﬁles, if successful, is from the JPEG ﬁle 49th bytes begin with
0 x86 or decryption:

The decrypted ﬁle is a DLL ﬁle, which is then loaded and executed.DLL program will ﬁrst determine the
running environment and check whether the DLL loading process is rundll32.exe:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

20/32

11/29/2018

360威胁情报中心

If the loading process is not rundll32.dll, release the backdoor program named aﬂup64.dll under C:
ProgramData\Adobe64:

Exe "C:\ ProgramData\ Adobe64\ aﬂup64.dll", exe "C:\ ProgramData\ Adobe64\ aﬂup64.dll"

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

21/32

11/29/2018

360威胁情报中心

Finally, start rundll32.exe to load aﬂup64.dll and call its export function IntRun:

Backdoor - aﬂup64. DLL
MD5
Compile time

91e3aa8fa918caa9a8e70466a9515666
2018.10.12

Exportation IntRun will do the same thing again, get the JPEG ﬁle, xor decrypt it, and then
execute.Because it is through rundll32 starts, so will go to another branch, ﬁrst create the mutex "9
a5f4cc4b39b13a6aecfe4c37179ea63" :

Then, create "nnp74DE. TMP" ﬁle in the directory of %TEMP%. Then, execute the command tasklist,
ipconﬁg./all, dir to get system process information, network information, ﬁle list and so on.

Then get the machine ID, system version, current system time, connect all the acquired information
beginning with "tag FluﬀyBunny", base64-encoded connect C&C and upload:
https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

22/32

11/29/2018

360威胁情报中心

After the information transmission is successful, Base64 encoding of the string "OK" will be returned:

If the request line is not successful, the request line is looped.After the successful launch, it will enter
the second stage to send base64-encoded data of calculation name-user name to
jospubs/foth1018/go.php and obtain the command execution:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

23/32

11/29/2018

360威胁情报中心

The format of relevant commands that can be obtained is in the form of "number: parameter", which
supports 5 commands in total. The list of relevant commands is as follows:
The command ID
103
105
115
117
120

function
Download the Plugin and drop it into the %TEMP% directory
Gets the ﬁle memory load
Gets the contents of the parameter ﬁle
Delete the start. LNK ﬁle
Download the ﬁle to the %temp% directory and delete start.lnk

The Plugins - jv77CF. TMP
MD5
Compile time

c9c1ec9ae1f142a8751ef470afa20f15
2018.4.3

In the debugging process of 360 Threat Intelligence Center analysts, we successfully acquired a Trojan
horse plug-in which was executed on the ground.The Trojan plugin continues to get the encrypted ﬁle from
pp5.zapto.org:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

24/32

11/29/2018

360威胁情报中心

Upon successful retrieval, hetero or decryption is performed, and the decrypted ﬁle is a remote back
door generated by Cobalt Strike:

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

25/32

11/29/2018

360威胁情报中心

Analysis of CVE-2017-11882 Samples

By expanding the big data platform of 360 Threat Intelligence Center, we found a vulnerability
utilization document of Oﬃce cve-2017-11882 belonging to the same series of attack activities.The
document is called "SOP for Retrieval of Mobile Data Records. Doc", which is the same name as the
https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

26/32

11/29/2018

360威胁情报中心

InPage vulnerability for the release of the WSCSPL Trojan (with the same origin as the Retrieval of the
impersonal Records). However, the vulnerability document is targeted at Microsoft Oﬃce.
MD5
The ﬁle name

61a107fee55e13e67a1f6cbc9183d0a4
For SOP for Retrieval of Mobile Data Records. Doc

The Objdata object information containing the vulnerability is as follows:

After the vulnerability successfully triggers the execution, subsequent Payload executables will be
obtained by means of the same download address as the SOP for Retrieval of Mobile Data Records. Inp
(InPage) vulnerability makes use of the ﬁle for the Retrieval of Mobile Data Records:

Attribution and Correlation

360 Threat Intelligence Center through the analysis of this batch of InPage vulnerability utilization
documents and related attack activities, it is the "BITTER" APT organization disclosed by 360 company in
https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

27/32

11/29/2018

360威胁情报中心

2016 that is the group behind the targeted attack using WSCSPL backdoor program[5]And after further
analysis, many samples in the series of attacks are also strongly related to APT organizations such as
mahagrass, Bahamut and Confucius.

BITTER APT Group

After in-depth analysis of several InPage vulnerability documents with a relatively short attack time by
360 Threat Intelligence Center, it was found that the Trojan program released by the vulnerability document
was the backdoor program used by APT organization "manlinghua" exposed by 360 company in 2016[5], is
the analysis of the WSCSPL full - featured backdoor program.
Command ID
2000
2001
2002
2004
2005
2006
2007
2009
2012
2013
2015
2016
2017
2019
2021
2022
2023
2025

Function
Retrieve RAT status information
Retrieve hard disk list
Retrieve ﬁle list in given directory
Retrieve RAT log 1
Create ﬁle by given ﬁlename
Write bytes into created ﬁle (2005)
Open ﬁle
Read ﬁle content (2007)
Create remote console
Execute remote command
Retrieve RAT log 2
Terminate remote console
Close handle
Retrieve a list of processes with UPD activity link
Retrieve RAT log 3
Terminate process by process ID
Retrieve a list of active processes
Retrieve RAT log 4

In addition, many of these C&C addresses are also strongly related to APT organization "manlinghua" in
the internal analysis platform of 360 Threat Intelligence Center. These C&C addresses have been
repeatedly used in attacks against China.Therefore, the relevant attack activities can be identiﬁed as "vine
spirit ﬂower".

Relation to Confucius

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

28/32

11/29/2018

360威胁情报中心

Delphi backdoor attack framework used in the C&C address errorfeedback.com in Trend Micro
exploring Confucius and mahagrass similarity[10]Appears that the domain name has been disclosed as a
trend of Confucius use.

Relation to Patchwork

Through the in-depth analysis and correlation of Delphi backdoor attack framework mentioned above,
we also found that the attack framework and sample also appeared in the InPage attack sample analyzed
by Palo Alto in 2017[13]Palo Alto thought the attack framework and backdoor might have something to do
with mahagrass.

Relation to "Bahamut"

A vulnerability document "AAT national assembly ﬁnal.inp" analyzed by 360 Threat Intelligence Center
into the attack activity was ﬁnally executed by the Trojan horse (Visual Basic backdoor program) using the
domain name referﬁle.com as C2, which was published by Cisco Talos security research team in July 2018
as "a case of targeted attack against Indian iOS users".[9]It was revealed that Talos security research team
associated with this domain name was also used by a Visual Basic backdoor program, and the related
network assets were suspected to be owned by APT organization "Bahamut".

Summary and Conjecture

360 Threat Intelligence Center analyzed a group of document samples with same attribution
(timestamp, ShellCode, InPage100 ﬂow size, ﬂow characteristics) , and found that those samples use at
least 4 diﬀerent malicious code framework, and have connections with "PatchWork", "BITTER”,
"Confucius", "Bahamut" APT organization has produced more or less.Maybe these APT groups are actually
one group? Or their digital weapons are provided by one vendor(Their supporter give them same
exploitation tools)?
https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

29/32

11/29/2018

360威胁情报中心

The following is a TTP summary of APT groups mentioned in this article:
BITTER

Target

PatchWork
PC/Android

PC/Android

Bahamut
South Asia (mainly Pakis
tan), Middle East
PC/Android/iOS

Delphi/c #

Delphi

Delphi/VB

China, Pakistan China, Pakistan

Attack platform PC/Android
Programming la C
nguage
Attack vector Spear-phishing
attack

Confucius
South Asia

Social networks, spear-phi Social network
shing attack

Social networks, spearphishing attack

IOC
Documents with InPage vulnerability
863f2bfed6e8e1b8b4516e328c8ba41b
ce2a6437a308dfe777dec42eec39d9ea
74aeaeaca968ﬀ69139b2e2c84dc6fa6
Oﬃce vulnerability exploit documents
61a107fee55e13e67a1f6cbc9183d0a4
Trojans
c3f5add704f2c540f3dd345f853e2d84
f9aeac76f92f8b2ddc253b3f53248c1d
8dda6f85f06b5952beaabbfea9e28cdd
25689fc7581840e851c3140aa8c3ac8b
1c2a3aa370660b3ac2bf0f41c342373b
43920ec371fae4726d570fdef1009163
694040b229562b8dca9534c5301f8d73
fec0ca2056d679a63ca18cb132223332
ec834fa821b2ddbe8b564b3870f13b1b
09d600e1cc9c6da648d9a367927e6bﬀ
91e3aa8fa918caa9a8e70466a9515666
4f9ef6f18e4c641621f4581a5989284c
afed882f6af66810d7637ebcd8287ddc
C&C
https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

30/32

11/29/2018

khurram.com.pk
nethosttalk.com
xiovo416.net
nethosttalk.com
newmysticvision.com
wcnchost.ddns.net
referﬁle.com
errorfeedback.com
Jospubs.com
traxbin.com
referﬁle.com

360威胁情报中心

Reference

[1]. https://ti.360.net/
[2]. http://www.inpage.com/
[3]. https://en.wikipedia.org/wiki/InPage
[4]. https://ti.360.net/blog/articles/analysis-of-apt-campaign-bitter/
[5]. https://www.anquanke.com/post/id/84910
[6]. https://www.kaspersky.com/blog/inpage-exploit/6292/
[7]. https://cloudblogs.microsoft.com/microsoftsecure/2018/11/08/attack-uses-malicious-inpagedocument-and-outdated-vlc-media-player-to-give-attackers-backdoor-access-to-targets/
[8]. https://blog.talosintelligence.com/2018/07/Mobile-Malware-Campaign-uses-Malicious-MDM.html
[9]. https://blog.talosintelligence.com/2018/07/Mobile-Malware-Campaign-uses-Malicious-MDMPart2.html
[10]. https://blog.trendmicro.com/trendlabs-security-intelligence/confucius-update-new-tools-andtechniques-further-connections-with-patchwork/
[11]. https://documents.trendmicro.com/assets/appendix-confucius-update-new-tools-techniquesconnections-patchwork-updated.pdf
[12]. https://researchcenter.paloaltonetworks.com/2016/09/unit42-confucius-says-malware-familiesget-further-by-abusing-legitimate-websites/
[13]. https://researchcenter.paloaltonetworks.com/2017/11/unit42-recent-inpage-exploits-lead-multiplemalware-families/
https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

31/32

11/29/2018

360威胁情报中心

[14].
https://www.virustotal.com/gui/ﬁle/9bf55fcf0a25a2f7f6d03e7ba6123d5a31c3e6c1196efae453a74d6ﬀf9d43b
b/submissions
蔓灵花 BITTER APT INPAGE 摩诃草 CONFUCIUS BAHAMUT

分享到：
首页
Analysis Of Targeted Attack Against Pakistan By Exploiting InPage Vulnerability And Related APT Groups

https://ti.360.net/blog/articles/analysis-of-targeted-attack-against-pakistan-by-exploiting-inpage-vulnerability-and-related-apt-groups-english/

32/32